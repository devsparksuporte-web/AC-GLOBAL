import{c as e,i as t,o as n,r,t as i}from"./index-C9yBzEdM.js";/* empty css                 */import"./conformidadeService-DTfsGcFE.js";import{t as a}from"./ordensService-CQbPUMAW.js";import{t as o}from"./preventivaService-BBUvhp7P.js";var s=e(n(),1),c=r(),l=()=>(0,c.jsx)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:(0,c.jsx)(`polyline`,{points:`15 18 9 12 15 6`})}),u=()=>(0,c.jsx)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:(0,c.jsx)(`polyline`,{points:`9 18 15 12 9 6`})}),d=()=>(0,c.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,c.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,c.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),f=[`Dom`,`Seg`,`Ter`,`Qua`,`Qui`,`Sex`,`Sáb`],p=[`Janeiro`,`Fevereiro`,`Março`,`Abril`,`Maio`,`Junho`,`Julho`,`Agosto`,`Setembro`,`Outubro`,`Novembro`,`Dezembro`];function m(e){return{instalacao:`Instalação`,manutencao:`Manutenção`,reparo:`Reparo`,limpeza:`Limpeza`,preventiva:`Preventiva (PMOC)`}[e]||e}function h(e,t,n){let r=[],i=new Date;i.setHours(0,0,0,0);let a=new Date(e,t,1).getDay(),o=new Date(e,t+1,0).getDate(),s=new Date(e,t,0);for(let i=a-1;i>=0;i--){let a=new Date(e,t-1,s.getDate()-i);r.push({date:a,isCurrentMonth:!1,isToday:!1,events:g(a,n)})}for(let a=1;a<=o;a++){let o=new Date(e,t,a);r.push({date:o,isCurrentMonth:!0,isToday:o.getTime()===i.getTime(),events:g(o,n)})}let c=42-r.length;for(let i=1;i<=c;i++){let a=new Date(e,t+1,i);r.push({date:a,isCurrentMonth:!1,isToday:!1,events:g(a,n)})}return r}function g(e,t){return t.filter(t=>t.date.getDate()===e.getDate()&&t.date.getMonth()===e.getMonth()&&t.date.getFullYear()===e.getFullYear())}function _({date:e,events:n,onClose:r}){let i=t(),a=e.toLocaleDateString(`pt-BR`,{weekday:`long`,day:`numeric`,month:`long`,year:`numeric`});return(0,c.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,c.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`500px`},onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)(`div`,{className:`modal-header`,children:[(0,c.jsx)(`h2`,{className:`modal-title`,children:`Agendamentos`}),(0,c.jsx)(`button`,{className:`modal-close`,onClick:r,children:(0,c.jsx)(d,{})})]}),(0,c.jsxs)(`div`,{className:`modal-body`,children:[(0,c.jsx)(`div`,{className:`day-detail-header`,children:(0,c.jsx)(`div`,{className:`day-detail-date`,children:a})}),n.length===0?(0,c.jsx)(`div`,{className:`empty-day`,children:`Nenhum agendamento para este dia`}):(0,c.jsx)(`div`,{className:`day-events-list`,children:n.map(e=>(0,c.jsxs)(`div`,{className:`event-card ${e.tipo}`,onClick:()=>i(e.tipo===`preventiva`?`/preventiva`:`/ordens`),children:[(0,c.jsxs)(`div`,{className:`event-card-header`,children:[(0,c.jsx)(`span`,{className:`event-order-number`,children:e.tipo===`preventiva`?`Preventiva`:`OS #${e.originalData.numero}`}),(0,c.jsx)(`span`,{className:`event-type`,children:e.tipo===`preventiva`?`Preventiva (PMOC)`:m(e.originalData.tipo)})]}),(0,c.jsx)(`div`,{className:`event-client`,children:e.originalData.cliente?.nome||`Cliente`}),e.originalData.descricao&&(0,c.jsx)(`div`,{className:`event-description`,children:e.originalData.descricao}),e.tipo===`preventiva`&&e.originalData.titulo&&(0,c.jsxs)(`div`,{className:`event-description`,children:[e.originalData.titulo,` - `,e.originalData.equipamento]})]},e.id))})]})]})})}function v(){let{user:e,userProfile:t}=i(),[n,r]=(0,s.useState)(new Date),[d,m]=(0,s.useState)([]),[g,v]=(0,s.useState)(!0),[y,b]=(0,s.useState)(null),x=n.getFullYear(),S=n.getMonth();(0,s.useEffect)(()=>{(async()=>{if(!(!e||!t))try{v(!0);let[n,r]=await Promise.all([a.listar(),o.listarPlanos(t.empresa_id)]),i=[];n.filter(e=>e.data_agendamento).forEach(e=>{i.push({id:e.id,date:new Date(e.data_agendamento),label:`OS #${e.numero} - ${e.cliente?.nome||`Cliente`}`,tipo:e.tipo,originalData:e})}),r.filter(n=>n.proxima_visita&&(t.role===`admin`||t.role===`super_admin`||n.criado_por===e.id)).forEach(e=>{i.push({id:e.id,date:new Date(e.proxima_visita),label:`Prev: ${e.cliente?.nome||`Cliente`}`,tipo:`preventiva`,originalData:e})}),m(i)}catch(e){console.error(`Erro ao carregar eventos:`,e)}finally{v(!1)}})()},[e,t]);let C=h(x,S,d);return(0,c.jsxs)(`div`,{className:`agenda-page`,children:[(0,c.jsxs)(`div`,{className:`calendar-header`,children:[(0,c.jsxs)(`div`,{className:`calendar-nav`,children:[(0,c.jsx)(`button`,{className:`calendar-nav-btn`,onClick:()=>{r(new Date(x,S-1,1))},children:(0,c.jsx)(l,{})}),(0,c.jsxs)(`h2`,{className:`calendar-title`,children:[p[S],` `,x]}),(0,c.jsx)(`button`,{className:`calendar-nav-btn`,onClick:()=>{r(new Date(x,S+1,1))},children:(0,c.jsx)(u,{})})]}),(0,c.jsx)(`button`,{className:`today-btn`,onClick:()=>{r(new Date)},children:`Hoje`})]}),g?(0,c.jsx)(`div`,{className:`table-container`,children:(0,c.jsx)(`div`,{className:`loading-spinner`,children:(0,c.jsx)(`div`,{className:`spinner`})})}):(0,c.jsxs)(`div`,{className:`calendar-container`,children:[(0,c.jsx)(`div`,{className:`calendar-weekdays`,children:f.map(e=>(0,c.jsx)(`div`,{className:`weekday`,children:e},e))}),(0,c.jsx)(`div`,{className:`calendar-days`,children:C.map((e,t)=>(0,c.jsxs)(`div`,{className:`calendar-day ${e.isCurrentMonth?``:`other-month`} ${e.isToday?`today`:``}`,onClick:()=>b(e),children:[(0,c.jsx)(`div`,{className:`day-header`,children:(0,c.jsx)(`span`,{className:`day-number`,children:e.date.getDate()})}),(0,c.jsxs)(`div`,{className:`day-events`,children:[e.events.slice(0,2).map(e=>(0,c.jsxs)(`div`,{className:`event-item ${e.tipo}`,children:[e.label.split(` - `)[0],`...`]},e.id)),e.events.length>2&&(0,c.jsxs)(`div`,{className:`more-events`,children:[`+`,e.events.length-2,` mais`]})]})]},t))}),(0,c.jsxs)(`div`,{className:`calendar-legend`,children:[(0,c.jsxs)(`div`,{className:`legend-item`,children:[(0,c.jsx)(`div`,{className:`legend-color preventiva`}),(0,c.jsx)(`span`,{children:`Preventiva (PMOC)`})]}),(0,c.jsxs)(`div`,{className:`legend-item`,children:[(0,c.jsx)(`div`,{className:`legend-color instalacao`}),(0,c.jsx)(`span`,{children:`Instalação`})]}),(0,c.jsxs)(`div`,{className:`legend-item`,children:[(0,c.jsx)(`div`,{className:`legend-color manutencao`}),(0,c.jsx)(`span`,{children:`Manutenção`})]}),(0,c.jsxs)(`div`,{className:`legend-item`,children:[(0,c.jsx)(`div`,{className:`legend-color reparo`}),(0,c.jsx)(`span`,{children:`Reparo`})]}),(0,c.jsxs)(`div`,{className:`legend-item`,children:[(0,c.jsx)(`div`,{className:`legend-color limpeza`}),(0,c.jsx)(`span`,{children:`Limpeza`})]})]})]}),y&&(0,c.jsx)(_,{date:y.date,events:y.events,onClose:()=>b(null)})]})}export{v as AgendaPage,v as default};