import{c as e,o as t,r as n,t as r}from"./index-C9yBzEdM.js";import{t as i}from"./adminService-DRZDLqYL.js";import{a,n as o,o as s,r as c,s as l}from"./validators-CnV3xIXR.js";/* empty css                 */import{t as u}from"./clientesService-BnZzC_Tg.js";var d=e(t(),1),f=n(),p=()=>(0,f.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,f.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),m=()=>(0,f.jsxs)(`svg`,{width:`18`,height:`18`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`circle`,{cx:`11`,cy:`11`,r:`8`}),(0,f.jsx)(`line`,{x1:`21`,y1:`21`,x2:`16.65`,y2:`16.65`})]}),h=()=>(0,f.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`path`,{d:`M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`}),(0,f.jsx)(`path`,{d:`M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z`})]}),g=()=>(0,f.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`polyline`,{points:`3 6 5 6 21 6`}),(0,f.jsx)(`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`})]}),_=()=>(0,f.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,f.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),v=()=>(0,f.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`}),(0,f.jsx)(`circle`,{cx:`9`,cy:`7`,r:`4`}),(0,f.jsx)(`path`,{d:`M22 21v-2a4 4 0 0 0-3-3.87`}),(0,f.jsx)(`path`,{d:`M16 3.13a4 4 0 0 1 0 7.75`})]}),y=()=>(0,f.jsxs)(`svg`,{width:`32`,height:`32`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,f.jsx)(`path`,{d:`M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z`}),(0,f.jsx)(`line`,{x1:`12`,y1:`9`,x2:`12`,y2:`13`}),(0,f.jsx)(`line`,{x1:`12`,y1:`17`,x2:`12.01`,y2:`17`})]});function b({cliente:e,onClose:t,onSave:n,empresas:r,isSuperAdmin:i}){let[p,m]=(0,d.useState)(()=>({nome:e?.nome||``,telefone:e?.telefone||``,email:e?.email||``,endereco:``,cidade:e?.cidade||``,estado:e?.estado||``,cep:e?.cep||``,observacoes:e?.observacoes||``,logradouro:e?.endereco||``,numero:``,bairro:``,complemento:``,empresa_id:e?e.empresa_id:``})),[h,g]=(0,d.useState)(!1),[v,y]=(0,d.useState)(!1),[b,x]=(0,d.useState)(``),S=async e=>{let t=e.replace(/\D/g,``);if(t.length===8){y(!0);try{let e=await(await fetch(`https://viacep.com.br/ws/${t}/json/`)).json();e.erro||m(t=>({...t,logradouro:e.logradouro,bairro:e.bairro,cidade:e.localidade,estado:e.uf,complemento:``}))}catch(e){console.error(`Erro ao buscar CEP:`,e)}finally{y(!1)}}};return(0,f.jsx)(`div`,{className:`modal-overlay`,onClick:t,children:(0,f.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,f.jsxs)(`div`,{className:`modal-header`,children:[(0,f.jsx)(`h2`,{className:`modal-title`,children:e?`Editar Cliente`:`Novo Cliente`}),(0,f.jsx)(`button`,{className:`modal-close`,onClick:t,children:(0,f.jsx)(_,{})})]}),(0,f.jsxs)(`form`,{onSubmit:async t=>{if(t.preventDefault(),!p.nome.trim()){x(`O nome é obrigatório`);return}g(!0),x(``);let r=[];p.logradouro&&r.push(p.logradouro),p.numero&&r.push(p.numero),p.bairro&&r.push(`- ${p.bairro}`),p.complemento&&r.push(`(${p.complemento})`);let i=r.length>0?r.join(`, `).replace(`, -`,` -`):p.logradouro,a=l(p.cpf||``);if(a&&!o(p.cpf||``)){alert(`CPF inválido. Por favor, verifique os dígitos.`);return}let s={nome:p.nome,telefone:l(p.telefone||``),email:p.email,cidade:p.cidade,estado:p.estado,cep:l(p.cep||``),cpf:a,observacoes:p.observacoes,endereco:i||``,empresa_id:p.empresa_id};try{e?await u.atualizar(e.id,s):await u.criar(s),n()}catch(e){console.error(e),x(e.message||`Erro ao salvar cliente.`)}finally{g(!1)}},children:[(0,f.jsxs)(`div`,{className:`modal-body`,children:[b&&(0,f.jsx)(`div`,{className:`error-message`,style:{marginBottom:`1rem`},children:b}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Nome *`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.nome,onChange:e=>m({...p,nome:e.target.value}),placeholder:`Nome do cliente`,disabled:h})]}),i&&(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Empresa *`}),(0,f.jsxs)(`select`,{className:`form-input`,value:p.empresa_id,onChange:e=>m({...p,empresa_id:e.target.value}),disabled:h||!!e,children:[(0,f.jsx)(`option`,{value:``,children:`Selecione uma empresa`}),r.map(e=>(0,f.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,f.jsxs)(`div`,{className:`form-row`,children:[(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Telefone`}),(0,f.jsx)(`input`,{type:`tel`,className:`form-input`,value:p.telefone,onChange:e=>m({...p,telefone:s(e.target.value)}),placeholder:`(00) 00000-0000`,disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Email`}),(0,f.jsx)(`input`,{type:`email`,className:`form-input`,value:p.email,onChange:e=>m({...p,email:e.target.value}),placeholder:`email@exemplo.com`,disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`CPF (Opcional)`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.cpf,onChange:e=>m({...p,cpf:a(e.target.value)}),placeholder:`000.000.000-00`,disabled:h})]})]}),(0,f.jsxs)(`div`,{className:`form-row`,children:[(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`CEP`}),(0,f.jsxs)(`div`,{style:{position:`relative`},children:[(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.cep,onChange:e=>m({...p,cep:c(e.target.value)}),onBlur:e=>{S(e.target.value)},placeholder:`00000-000`,disabled:h||v}),v&&(0,f.jsx)(`span`,{style:{position:`absolute`,right:10,top:10,fontSize:`0.8rem`},children:`Busca...`})]})]}),(0,f.jsxs)(`div`,{className:`form-group`,style:{flex:2},children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Cidade`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.cidade,onChange:e=>m({...p,cidade:e.target.value}),disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-group`,style:{flex:.5},children:[(0,f.jsx)(`label`,{className:`form-label`,children:`UF`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.estado,onChange:e=>m({...p,estado:e.target.value}),maxLength:2,disabled:h})]})]}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Endereço (Rua/Av)`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.logradouro,onChange:e=>m({...p,logradouro:e.target.value}),placeholder:`Logradouro`,disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-row`,children:[(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Número`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.numero,onChange:e=>m({...p,numero:e.target.value}),placeholder:`Nº`,disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-group`,style:{flex:2},children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Bairro`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.bairro,onChange:e=>m({...p,bairro:e.target.value}),placeholder:`Bairro`,disabled:h})]})]}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Complemento / Referência`}),(0,f.jsx)(`input`,{type:`text`,className:`form-input`,value:p.complemento,onChange:e=>m({...p,complemento:e.target.value}),placeholder:`Apto, Bloco, Próximo a...`,disabled:h})]}),(0,f.jsxs)(`div`,{className:`form-group`,children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Observações`}),(0,f.jsx)(`textarea`,{className:`form-input`,value:p.observacoes,onChange:e=>m({...p,observacoes:e.target.value}),placeholder:`Observações adicionais...`,disabled:h})]})]}),(0,f.jsxs)(`div`,{className:`modal-footer`,children:[(0,f.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:t,disabled:h,children:`Cancelar`}),(0,f.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:h,children:h?`Salvando...`:e?`Salvar Alterações`:`Cadastrar Cliente`})]})]})]})})}function x({title:e,message:t,onConfirm:n,onCancel:r,loading:i}){return(0,f.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,f.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`400px`},onClick:e=>e.stopPropagation(),children:[(0,f.jsx)(`div`,{className:`modal-body`,children:(0,f.jsxs)(`div`,{className:`confirm-dialog`,children:[(0,f.jsx)(`div`,{className:`confirm-icon`,children:(0,f.jsx)(y,{})}),(0,f.jsx)(`h3`,{className:`confirm-title`,children:e}),(0,f.jsx)(`p`,{className:`confirm-message`,children:t})]})}),(0,f.jsxs)(`div`,{className:`modal-footer`,children:[(0,f.jsx)(`button`,{className:`btn-secondary`,onClick:r,disabled:i,children:`Cancelar`}),(0,f.jsx)(`button`,{className:`btn-primary btn-danger`,onClick:n,disabled:i,children:i?`Excluindo...`:`Excluir`})]})]})})}function S(){let{isSuperAdmin:e}=r(),[t,n]=(0,d.useState)([]),[a,o]=(0,d.useState)([]),[s,c]=(0,d.useState)(!0),[l,_]=(0,d.useState)(``),[y,S]=(0,d.useState)(!1),[C,w]=(0,d.useState)(null),[T,E]=(0,d.useState)(null),[D,O]=(0,d.useState)(!1);(0,d.useEffect)(()=>{e&&i.listarEmpresas().then(o).catch(console.error)},[e]);let k=async()=>{try{c(!0),n(l?await u.buscar(l):await u.listar())}catch(e){console.error(`Erro ao carregar clientes:`,e)}finally{c(!1)}};(0,d.useEffect)(()=>{k()},[l]);let A=()=>{w(null),S(!0)},j=e=>{w(e),S(!0)},M=async()=>{if(T){O(!0);try{await u.excluir(T.id),E(null),k()}catch(e){console.error(`Erro ao excluir cliente:`,e)}finally{O(!1)}}},N=()=>{S(!1),w(null)};return(0,f.jsxs)(`div`,{className:`clientes-page`,children:[(0,f.jsxs)(`div`,{className:`page-header`,children:[(0,f.jsx)(`h1`,{className:`page-title`,children:`Clientes`}),(0,f.jsxs)(`button`,{className:`btn-primary`,onClick:A,children:[(0,f.jsx)(p,{}),`Novo Cliente`]})]}),(0,f.jsx)(`div`,{className:`search-bar`,children:(0,f.jsxs)(`div`,{className:`search-input-wrapper`,children:[(0,f.jsx)(`span`,{className:`input-icon`,children:(0,f.jsx)(m,{})}),(0,f.jsx)(`input`,{type:`text`,className:`search-input`,placeholder:`Buscar por nome, telefone ou email...`,value:l,onChange:e=>_(e.target.value)})]})}),s?(0,f.jsx)(`div`,{className:`table-container`,children:(0,f.jsx)(`div`,{className:`loading-spinner`,children:(0,f.jsx)(`div`,{className:`spinner`})})}):t.length===0?(0,f.jsx)(`div`,{className:`table-container`,children:(0,f.jsxs)(`div`,{className:`empty-state`,children:[(0,f.jsx)(`div`,{className:`empty-icon`,children:(0,f.jsx)(v,{})}),(0,f.jsx)(`h3`,{className:`empty-title`,children:l?`Nenhum cliente encontrado`:`Nenhum cliente cadastrado`}),(0,f.jsx)(`p`,{className:`empty-description`,children:l?`Tente buscar com outros termos`:`Comece cadastrando seu primeiro cliente`}),!l&&(0,f.jsxs)(`button`,{className:`btn-primary`,onClick:A,children:[(0,f.jsx)(p,{}),`Cadastrar Cliente`]})]})}):(0,f.jsx)(`div`,{className:`table-container`,children:(0,f.jsxs)(`table`,{className:`data-table`,children:[(0,f.jsx)(`thead`,{children:(0,f.jsxs)(`tr`,{children:[(0,f.jsx)(`th`,{children:`Nome`}),(0,f.jsx)(`th`,{children:`Telefone`}),(0,f.jsx)(`th`,{children:`Email`}),(0,f.jsx)(`th`,{children:`Cidade`}),(0,f.jsx)(`th`,{children:`Ações`})]})}),(0,f.jsx)(`tbody`,{children:t.map(e=>(0,f.jsxs)(`tr`,{children:[(0,f.jsx)(`td`,{className:`table-name`,"data-label":`Nome`,children:e.nome}),(0,f.jsx)(`td`,{"data-label":`Telefone`,children:e.telefone||`-`}),(0,f.jsx)(`td`,{"data-label":`Email`,children:e.email||`-`}),(0,f.jsx)(`td`,{"data-label":`Cidade`,children:e.cidade?`${e.cidade}/${e.estado}`:`-`}),(0,f.jsx)(`td`,{"data-label":`Ações`,children:(0,f.jsxs)(`div`,{className:`table-actions`,children:[(0,f.jsx)(`button`,{className:`btn-icon`,onClick:()=>j(e),title:`Editar`,children:(0,f.jsx)(h,{})}),(0,f.jsx)(`button`,{className:`btn-icon danger`,onClick:()=>E(e),title:`Excluir`,children:(0,f.jsx)(g,{})})]})})]},e.id))})]})}),y&&(0,f.jsx)(b,{cliente:C,onClose:N,onSave:()=>{N(),k()},empresas:a,isSuperAdmin:e}),T&&(0,f.jsx)(x,{title:`Excluir Cliente`,message:`Tem certeza que deseja excluir o cliente "${T.nome}"? Ao confirmar a exclusão, todos os chamados vinculados a esse cliente serão mantidos no sistema para fins de histórico.`,onConfirm:M,onCancel:()=>E(null),loading:D})]})}export{S as ClientesPage,S as default};