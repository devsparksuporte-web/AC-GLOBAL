import{c as e,o as t,r as n,t as r}from"./index-C9yBzEdM.js";import{t as i}from"./adminService-DRZDLqYL.js";import{t as a}from"./conformidadeService-DTfsGcFE.js";var o=e(t(),1),s=n();function c({empresaId:e,onClose:t,onSave:n}){let[r,i]=(0,o.useState)(``),[c,l]=(0,o.useState)(``),[u,d]=(0,o.useState)(!1),[f,p]=(0,o.useState)(!1);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:t,children:(0,s.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsx)(`h2`,{className:`modal-title`,children:`Nova CertificaÃ§Ã£o / Treinamento`}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:t,children:`âœ•`})]}),(0,s.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),p(!0);try{await a.salvarCertificacao({empresa_id:e,nome:r,descricao:c,obrigatoria:u}),n()}catch(e){console.error(e)}finally{p(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Nome (ex: NR-10)`}),(0,s.jsx)(`input`,{className:`form-input`,value:r,onChange:e=>i(e.target.value),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`DescriÃ§Ã£o`}),(0,s.jsx)(`textarea`,{className:`form-input`,value:c,onChange:e=>l(e.target.value)})]}),(0,s.jsxs)(`div`,{className:`form-group`,style:{flexDirection:`row`,gap:`0.5rem`},children:[(0,s.jsx)(`input`,{type:`checkbox`,checked:u,onChange:e=>d(e.target.checked),id:`obr`}),(0,s.jsx)(`label`,{htmlFor:`obr`,className:`form-label`,children:`ObrigatÃ³ria para todos os tÃ©cnicos`})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:t,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:f,children:`Salvar`})]})]})]})})}function l({empresaId:e,certificacoes:t,onClose:n,onSave:r}){let[i,c]=(0,o.useState)(``),[l,u]=(0,o.useState)(``),[d,f]=(0,o.useState)(`warning`),[p,m]=(0,o.useState)([]),[h,g]=(0,o.useState)(!1);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:n,children:(0,s.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsx)(`h2`,{className:`modal-title`,children:`Configurar Perfil de Risco`}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:n,children:`âœ•`})]}),(0,s.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),g(!0);try{await a.salvarTipoRisco({empresa_id:e,nome:i,descricao:l,cor_alerta:d,certificacoes_requeridas:p}),r()}catch(e){console.error(e)}finally{g(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Nome do Risco (ex: Trabalho em Altura)`}),(0,s.jsx)(`input`,{className:`form-input`,value:i,onChange:e=>c(e.target.value),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`DescriÃ§Ã£o`}),(0,s.jsx)(`textarea`,{className:`form-input`,value:l,onChange:e=>u(e.target.value)})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Severidade`}),(0,s.jsxs)(`select`,{className:`form-select`,value:d,onChange:e=>f(e.target.value),children:[(0,s.jsx)(`option`,{value:`warning`,children:`âš ï¸ MÃ©dio (Warning)`}),(0,s.jsx)(`option`,{value:`danger`,children:`â˜ ï¸ Alto (Danger)`})]})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`CertificaÃ§Ãµes Exigidas`}),(0,s.jsx)(`div`,{style:{display:`grid`,gridTemplateColumns:`1fr 1fr`,gap:`0.5rem`},children:t.map(e=>(0,s.jsxs)(`div`,{style:{display:`flex`,gap:`0.5rem`,fontSize:`0.85rem`},children:[(0,s.jsx)(`input`,{type:`checkbox`,checked:p.includes(e.id),onChange:t=>{t.target.checked?m([...p,e.id]):m(p.filter(t=>t!==e.id))}}),` `,e.nome]},e.id))})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:n,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:h,children:`Salvar Risco`})]})]})]})})}function u({empresaId:e,riscos:t,onClose:n,onSave:r}){let[i,c]=(0,o.useState)(``),[l,u]=(0,o.useState)(``),[d,f]=(0,o.useState)([{pergunta:``,obrigatorio:!0}]),[p,m]=(0,o.useState)(!1);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:n,children:(0,s.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`600px`},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsx)(`h2`,{className:`modal-title`,children:`Novo Modelo de Checklist`}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:n,children:`âœ•`})]}),(0,s.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),m(!0);try{await a.salvarChecklist({empresa_id:e,titulo:i,tipo_risco_id:l||void 0,itens:d.filter(e=>e.pergunta)}),r()}catch(e){console.error(e)}finally{m(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`TÃ­tulo do Checklist`}),(0,s.jsx)(`input`,{className:`form-input`,value:i,onChange:e=>c(e.target.value),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Vincular a Risco (Opcional)`}),(0,s.jsxs)(`select`,{className:`form-select`,value:l,onChange:e=>u(e.target.value),children:[(0,s.jsx)(`option`,{value:``,children:`Geral (Todos)`}),t.map(e=>(0,s.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Itens de VerificaÃ§Ã£o`}),d.map((e,t)=>(0,s.jsxs)(`div`,{style:{display:`flex`,gap:`0.5rem`,marginBottom:`0.5rem`},children:[(0,s.jsx)(`input`,{className:`form-input`,placeholder:`Ex: EPIs conferidos?`,value:e.pergunta,onChange:e=>{let n=[...d];n[t].pergunta=e.target.value,f(n)}}),(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:()=>f(d.filter((e,n)=>n!==t)),children:`âœ•`})]},t)),(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,style:{width:`100%`,marginTop:`0.5rem`},onClick:()=>f([...d,{pergunta:``,obrigatorio:!0}]),children:`+ Adicionar Item`})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:n,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:p,children:`Criar Checklist`})]})]})]})})}function d({empresaId:e,perfil:t,certificacoes:n,onClose:r,onSave:i}){let[c,l]=(0,o.useState)(``),[u,d]=(0,o.useState)(``),[f,p]=(0,o.useState)(``),[m,h]=(0,o.useState)(``),[g,_]=(0,o.useState)(!1);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,s.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsxs)(`h2`,{className:`modal-title`,children:[`Vincular Certificado: `,t.nome]}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:r,children:`âœ•`})]}),(0,s.jsxs)(`form`,{onSubmit:async n=>{n.preventDefault(),_(!0);try{await a.salvarCertificacaoTecnico({empresa_id:e,perfil_id:t.id,certificacao_id:c,data_emissao:u,data_vencimento:f,numero_registro:m,status:`ativo`}),i()}catch(e){console.error(e)}finally{_(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`CertificaÃ§Ã£o / Treinamento`}),(0,s.jsxs)(`select`,{className:`form-select`,value:c,onChange:e=>l(e.target.value),required:!0,children:[(0,s.jsx)(`option`,{value:``,children:`Selecione...`}),n.map(e=>(0,s.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Data EmissÃ£o`}),(0,s.jsx)(`input`,{className:`form-input`,type:`date`,value:u,onChange:e=>d(e.target.value),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Data Vencimento`}),(0,s.jsx)(`input`,{className:`form-input`,type:`date`,value:f,onChange:e=>p(e.target.value),required:!0})]})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`NÂº Registro/AutenticaÃ§Ã£o`}),(0,s.jsx)(`input`,{className:`form-input`,value:m,onChange:e=>h(e.target.value)})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:r,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:g,children:`Vincular`})]})]})]})})}function f(){let{userProfile:e}=r(),[t,n]=(0,o.useState)(`certificacoes`),[f,p]=(0,o.useState)([]),[m,h]=(0,o.useState)([]),[g,_]=(0,o.useState)([]),[v,y]=(0,o.useState)([]),[b,x]=(0,o.useState)(!0),[S,C]=(0,o.useState)(!1),[w,T]=(0,o.useState)(!1),[E,D]=(0,o.useState)(!1),[O,k]=(0,o.useState)(null),[A,j]=(0,o.useState)({}),M=e?.empresa_id||``,N=async()=>{if(M){x(!0);try{let[e,t,n,r]=await Promise.all([a.listarCertificacoes(M),i.listarUsuariosPorEmpresa(M),a.listarTiposRisco(M),a.listarChecklists(M)]);p(e),h(t.filter(e=>e.role===`tecnico`||e.role===`admin`)),_(n),y(r);let o={};await Promise.all(t.map(async e=>{let t=await a.listarCertificacoesTecnico(e.id);o[e.id]=t})),j(o)}catch(e){console.error(e)}finally{x(!1)}}};return(0,o.useEffect)(()=>{N()},[M]),b?(0,s.jsx)(`div`,{className:`conformidade-page`,children:(0,s.jsx)(`div`,{className:`loading-spinner`,children:`Carregando...`})}):(0,s.jsxs)(`div`,{className:`conformidade-page`,children:[(0,s.jsxs)(`div`,{className:`page-header`,children:[(0,s.jsx)(`h1`,{className:`page-title`,children:`GestÃ£o de Riscos e Conformidade`}),(0,s.jsx)(`div`,{className:`header-actions`,children:(0,s.jsx)(`button`,{className:`btn-primary`,onClick:()=>C(!0),children:`+ Nova CertificaÃ§Ã£o`})})]}),(0,s.jsxs)(`div`,{className:`conformidade-tabs`,children:[(0,s.jsx)(`button`,{className:`conformidade-tab ${t===`certificacoes`?`active`:``}`,onClick:()=>n(`certificacoes`),children:`ðŸ“œ CertificaÃ§Ãµes`}),(0,s.jsx)(`button`,{className:`conformidade-tab ${t===`riscos`?`active`:``}`,onClick:()=>n(`riscos`),children:`âš ï¸ Riscos e Alertas`}),(0,s.jsx)(`button`,{className:`conformidade-tab ${t===`checklists`?`active`:``}`,onClick:()=>n(`checklists`),children:`âœ… Checklists`})]}),t===`certificacoes`&&(0,s.jsxs)(`div`,{className:`tab-content`,children:[(0,s.jsxs)(`div`,{className:`section-header`,style:{marginBottom:`1.5rem`},children:[(0,s.jsx)(`h3`,{children:`CertificaÃ§Ãµes por TÃ©cnico`}),(0,s.jsx)(`p`,{children:`Acompanhe a validade das NRs e treinamentos obrigatÃ³rios.`})]}),m.map(e=>(0,s.jsxs)(`div`,{style:{marginBottom:`2rem`,background:`#f8fafc`,padding:`1.5rem`,borderRadius:`12px`},children:[(0,s.jsxs)(`div`,{style:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,marginBottom:`1rem`},children:[(0,s.jsxs)(`h4`,{style:{margin:0},children:[`ðŸ‘¤ `,e.nome]}),(0,s.jsx)(`button`,{className:`btn-secondary`,style:{fontSize:`0.8rem`},onClick:()=>k(e),children:`Adicionar Certificado`})]}),(0,s.jsxs)(`div`,{className:`cert-list`,children:[A[e.id]?.map(e=>(0,s.jsxs)(`div`,{className:`cert-card`,style:{borderLeft:e.status===`vencido`?`4px solid #ef4444`:`none`},children:[(0,s.jsxs)(`div`,{className:`cert-info`,children:[(0,s.jsx)(`h4`,{children:e.certificacao?.nome}),(0,s.jsxs)(`p`,{children:[`Vencimento: `,new Date(e.data_vencimento).toLocaleDateString()]})]}),(0,s.jsx)(`span`,{className:`cert-status ${e.status}`,children:e.status})]},e.id)),(!A[e.id]||A[e.id].length===0)&&(0,s.jsx)(`div`,{className:`empty-state`,style:{padding:`1rem`,fontSize:`0.8rem`},children:`Nenhum certificado registrado.`})]})]},e.id))]}),t===`riscos`&&(0,s.jsxs)(`div`,{className:`tab-content`,children:[(0,s.jsxs)(`div`,{style:{display:`flex`,justifyContent:`space-between`,marginBottom:`1.5rem`},children:[(0,s.jsx)(`h3`,{children:`ConfiguraÃ§Ã£o de Riscos`}),(0,s.jsx)(`button`,{className:`btn-secondary`,onClick:()=>T(!0),children:`+ Novo Risco`})]}),(0,s.jsx)(`div`,{className:`riscos-grid`,style:{display:`grid`,gridTemplateColumns:`repeat(auto-fit, minmax(300px, 1fr))`,gap:`1.5rem`},children:g.length===0?(0,s.jsx)(`div`,{className:`empty-state`,children:`Nenhum risco cadastrado.`}):g.map(e=>(0,s.jsxs)(`div`,{className:`card`,style:{padding:`1.5rem`},children:[(0,s.jsxs)(`div`,{style:{display:`flex`,alignItems:`center`,gap:`0.75rem`,marginBottom:`1rem`},children:[(0,s.jsx)(`span`,{className:`risco-badge ${e.cor_alerta}`,children:e.cor_alerta===`danger`?`â˜ ï¸ High Risk`:`âš ï¸ Alert`}),(0,s.jsx)(`h4`,{style:{margin:0},children:e.nome})]}),(0,s.jsx)(`p`,{style:{fontSize:`0.9rem`,color:`#64748b`},children:e.descricao}),(0,s.jsxs)(`div`,{style:{marginTop:`1rem`},children:[(0,s.jsx)(`span`,{style:{fontSize:`0.8rem`,fontWeight:600,color:`#475569`},children:`ExigÃªncias:`}),(0,s.jsxs)(`div`,{style:{display:`flex`,flexWrap:`wrap`,gap:`0.5rem`,marginTop:`0.5rem`},children:[e.certificacoes_requeridas.map(e=>(0,s.jsx)(`span`,{style:{background:`#f1f5f9`,padding:`0.2rem 0.6rem`,borderRadius:`4px`,fontSize:`0.75rem`},children:f.find(t=>t.id===e)?.nome||`CertificaÃ§Ã£o`},e)),e.certificacoes_requeridas.length===0&&(0,s.jsx)(`span`,{style:{fontStyle:`italic`,fontSize:`0.75rem`},children:`Nenhuma certificaÃ§Ã£o exigida`})]})]})]},e.id))})]}),t===`checklists`&&(0,s.jsxs)(`div`,{className:`tab-content`,children:[(0,s.jsxs)(`div`,{style:{display:`flex`,justifyContent:`space-between`,marginBottom:`1.5rem`},children:[(0,s.jsx)(`h3`,{children:`Modelos de Checklists de SeguranÃ§a`}),(0,s.jsx)(`button`,{className:`btn-primary`,onClick:()=>D(!0),children:`+ Novo Modelo`})]}),(0,s.jsx)(`div`,{className:`table-container`,children:(0,s.jsxs)(`table`,{className:`data-table`,children:[(0,s.jsx)(`thead`,{children:(0,s.jsxs)(`tr`,{children:[(0,s.jsx)(`th`,{children:`TÃ­tulo`}),(0,s.jsx)(`th`,{children:`Risco Associado`}),(0,s.jsx)(`th`,{children:`Itens`}),(0,s.jsx)(`th`,{children:`Criado em`}),(0,s.jsx)(`th`,{children:`AÃ§Ãµes`})]})}),(0,s.jsx)(`tbody`,{children:v.map(e=>(0,s.jsxs)(`tr`,{children:[(0,s.jsx)(`td`,{style:{fontWeight:600},children:e.titulo}),(0,s.jsx)(`td`,{children:e.tipo_risco_id?g.find(t=>t.id===e.tipo_risco_id)?.nome:`Geral`}),(0,s.jsxs)(`td`,{children:[e.itens.length,` verificaÃ§Ãµes`]}),(0,s.jsx)(`td`,{children:new Date(e.created_at).toLocaleDateString()}),(0,s.jsx)(`td`,{children:(0,s.jsx)(`button`,{className:`btn-secondary`,children:`Editar`})})]},e.id))})]})})]}),S&&(0,s.jsx)(c,{empresaId:M,onClose:()=>C(!1),onSave:()=>{C(!1),N()}}),w&&(0,s.jsx)(l,{empresaId:M,certificacoes:f,onClose:()=>T(!1),onSave:()=>{T(!1),N()}}),E&&(0,s.jsx)(u,{empresaId:M,riscos:g,onClose:()=>D(!1),onSave:()=>{D(!1),N()}}),O&&(0,s.jsx)(d,{empresaId:M,perfil:O,certificacoes:f,onClose:()=>k(null),onSave:()=>{k(null),N()}})]})}export{f as ConformidadePage,f as default};