import{c as e,n as t,o as n,r}from"./index-C9yBzEdM.js";/* empty css                 */var i=e(n(),1);const a={async listarArtigos(){let{data:e,error:n}=await t.from(`artigos_conhecimento`).select(`*, autor:perfis!autor_id(nome)`).order(`created_at`,{ascending:!1});if(n)throw n;return e||[]},async buscarArtigos(e){let{data:n,error:r}=await t.from(`artigos_conhecimento`).select(`*, autor:perfis!autor_id(nome)`).or(`titulo.ilike.%${e}%,descricao.ilike.%${e}%`).order(`created_at`,{ascending:!1});if(r)throw r;return n||[]},async criarArtigo(e){let{data:{user:n}}=await t.auth.getUser();if(!n)throw Error(`UsuÃ¡rio nÃ£o autenticado`);let{data:r}=await t.from(`perfis`).select(`empresa_id`).eq(`id`,n.id).single(),{data:i,error:a}=await t.from(`artigos_conhecimento`).insert({...e,autor_id:n.id,empresa_id:r?.empresa_id}).select().single();if(a)throw a;return i},async listarSolucoes(e){let{data:{user:n}}=await t.auth.getUser(),{data:r,error:i}=await t.from(`solucoes_conhecimento`).select(`*, autor:perfis!autor_id(nome)`).eq(`artigo_id`,e).order(`utilidade_score`,{ascending:!1});if(i)throw i;if(n&&r){let{data:e}=await t.from(`votos_solucoes`).select(`solucao_id, valor`).eq(`usuario_id`,n.id).in(`solucao_id`,r.map(e=>e.id));if(e)return r.map(t=>({...t,voto_usuario:e.find(e=>e.solucao_id===t.id)?.valor}))}return r||[]},async criarSolucao(e){let{data:{user:n}}=await t.auth.getUser();if(!n)throw Error(`UsuÃ¡rio nÃ£o autenticado`);let{data:r,error:i}=await t.from(`solucoes_conhecimento`).insert({...e,autor_id:n.id}).select().single();if(i)throw i;return r},async votar(e,n){let{data:{user:r}}=await t.auth.getUser();if(!r)throw Error(`UsuÃ¡rio nÃ£o autenticado`);let{error:i}=await t.from(`votos_solucoes`).upsert({solucao_id:e,usuario_id:r.id,valor:n});if(i)throw i},async listarRanking(){let{data:e,error:n}=await t.from(`pontuacao_tecnicos`).select(`*, usuario:perfis!usuario_id(nome)`).order(`pontos_totais`,{ascending:!1}).limit(10);if(n)throw n;return e||[]},async buscarMinhaPontuacao(){let{data:{user:e}}=await t.auth.getUser();if(!e)return null;let{data:n,error:r}=await t.from(`pontuacao_tecnicos`).select(`*`).eq(`usuario_id`,e.id).single();if(r&&r.code!==`PGRST116`)throw r;return n}};var o=r(),s=()=>(0,o.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,o.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),c=()=>(0,o.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,o.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),l=()=>(0,o.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`line`,{x1:`19`,y1:`12`,x2:`5`,y2:`12`}),(0,o.jsx)(`polyline`,{points:`12 19 5 12 12 5`})]}),u=()=>(0,o.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`path`,{d:`M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z`}),(0,o.jsx)(`path`,{d:`M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z`})]});function d({onClose:e,onSave:t}){let[n,r]=(0,i.useState)(``),[s,l]=(0,i.useState)(``),[u,d]=(0,i.useState)(``),[f,p]=(0,i.useState)(!1),[m,h]=(0,i.useState)(``);return(0,o.jsx)(`div`,{className:`modal-overlay`,onClick:e,children:(0,o.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)(`div`,{className:`modal-header`,children:[(0,o.jsx)(`h2`,{className:`modal-title`,children:`Novo Problema / TÃ³pico`}),(0,o.jsx)(`button`,{className:`modal-close`,onClick:e,children:(0,o.jsx)(c,{})})]}),(0,o.jsxs)(`form`,{onSubmit:async e=>{e.preventDefault(),p(!0),h(``);try{await a.criarArtigo({titulo:n,descricao:s,categoria:u}),t()}catch(e){h(`Erro ao criar artigo.`),console.error(e)}finally{p(!1)}},children:[(0,o.jsxs)(`div`,{className:`modal-body`,children:[m&&(0,o.jsx)(`div`,{className:`error-message`,children:m}),(0,o.jsxs)(`div`,{className:`form-group`,children:[(0,o.jsx)(`label`,{className:`form-label`,children:`TÃ­tulo do Problema *`}),(0,o.jsx)(`input`,{className:`form-input`,value:n,onChange:e=>r(e.target.value),placeholder:`Ex: Split nÃ£o gela mesmo apÃ³s limpeza`,required:!0})]}),(0,o.jsxs)(`div`,{className:`form-group`,children:[(0,o.jsx)(`label`,{className:`form-label`,children:`DescriÃ§Ã£o Detalhada *`}),(0,o.jsx)(`textarea`,{className:`form-input`,rows:4,value:s,onChange:e=>l(e.target.value),placeholder:`Descreva o problema com o mÃ¡ximo de detalhes possÃ­vel...`,required:!0})]}),(0,o.jsxs)(`div`,{className:`form-group`,children:[(0,o.jsx)(`label`,{className:`form-label`,children:`Categoria`}),(0,o.jsxs)(`select`,{className:`form-select`,value:u,onChange:e=>d(e.target.value),children:[(0,o.jsx)(`option`,{value:``,children:`Selecione...`}),[`Ar Condicionado`,`ElÃ©trica`,`InstalaÃ§Ã£o`,`ManutenÃ§Ã£o`,`RefrigeraÃ§Ã£o`,`Ferramentas`,`Outro`].map(e=>(0,o.jsx)(`option`,{value:e,children:e},e))]})]})]}),(0,o.jsxs)(`div`,{className:`modal-footer`,children:[(0,o.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:e,children:`Cancelar`}),(0,o.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:f,children:f?`Publicando...`:`Publicar`})]})]})]})})}function f({artigoId:e,onClose:t,onSave:n}){let[r,s]=(0,i.useState)(``),[l,u]=(0,i.useState)(!1),[d,f]=(0,i.useState)(``);return(0,o.jsx)(`div`,{className:`modal-overlay`,onClick:t,children:(0,o.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)(`div`,{className:`modal-header`,children:[(0,o.jsx)(`h2`,{className:`modal-title`,children:`Contribuir SoluÃ§Ã£o`}),(0,o.jsx)(`button`,{className:`modal-close`,onClick:t,children:(0,o.jsx)(c,{})})]}),(0,o.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),u(!0),f(``);try{await a.criarSolucao({artigo_id:e,conteudo:r}),n()}catch(e){f(`Erro ao enviar soluÃ§Ã£o.`),console.error(e)}finally{u(!1)}},children:[(0,o.jsxs)(`div`,{className:`modal-body`,children:[d&&(0,o.jsx)(`div`,{className:`error-message`,children:d}),(0,o.jsxs)(`div`,{className:`form-group`,children:[(0,o.jsx)(`label`,{className:`form-label`,children:`Sua SoluÃ§Ã£o / Dica *`}),(0,o.jsx)(`textarea`,{className:`form-input`,rows:6,value:r,onChange:e=>s(e.target.value),placeholder:`Descreva a soluÃ§Ã£o passo a passo. Quanto mais detalhes, mais Ãºtil para a equipe!`,required:!0})]}),(0,o.jsxs)(`p`,{style:{fontSize:`0.8rem`,color:`#64748b`},children:[`ðŸ† VocÃª ganha `,(0,o.jsx)(`strong`,{children:`+10 pontos`}),` por contribuir e `,(0,o.jsx)(`strong`,{children:`+5 pontos`}),` por cada voto positivo recebido!`]})]}),(0,o.jsxs)(`div`,{className:`modal-footer`,children:[(0,o.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:t,children:`Cancelar`}),(0,o.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:l,children:l?`Enviando...`:`Enviar SoluÃ§Ã£o`})]})]})]})})}function p(){let[e,t]=(0,i.useState)(`artigos`),[n,r]=(0,i.useState)([]),[c,p]=(0,i.useState)([]),[m,h]=(0,i.useState)(!0),[g,_]=(0,i.useState)(``),[v,y]=(0,i.useState)(!1),[b,x]=(0,i.useState)(null),[S,C]=(0,i.useState)([]),[w,T]=(0,i.useState)(!1),E=async()=>{h(!0);try{r(g?await a.buscarArtigos(g):await a.listarArtigos())}catch(e){console.error(`Erro ao carregar artigos:`,e)}finally{h(!1)}},D=async()=>{try{p(await a.listarRanking())}catch(e){console.error(`Erro ao carregar ranking:`,e)}},O=async e=>{try{C(await a.listarSolucoes(e))}catch(e){console.error(`Erro ao carregar soluÃ§Ãµes:`,e)}};(0,i.useEffect)(()=>{E(),D()},[]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{E()},400);return()=>clearTimeout(e)},[g]);let k=e=>{x(e),O(e.id)},A=async(e,t)=>{try{await a.votar(e,t),b&&O(b.id)}catch(e){console.error(`Erro ao votar:`,e)}},j=()=>{x(null),C([])},M=e=>new Date(e).toLocaleDateString(`pt-BR`),N=e=>e===0?`gold`:e===1?`silver`:e===2?`bronze`:`default`;return b?(0,o.jsxs)(`div`,{className:`kb-page`,children:[(0,o.jsxs)(`button`,{className:`kb-detail-back`,onClick:j,children:[(0,o.jsx)(l,{}),` Voltar para listagem`]}),(0,o.jsxs)(`div`,{className:`kb-detail-header`,children:[(0,o.jsx)(`div`,{className:`kb-detail-title`,children:b.titulo}),(0,o.jsx)(`div`,{className:`kb-detail-desc`,children:b.descricao}),(0,o.jsxs)(`div`,{className:`kb-article-meta`,style:{marginTop:`1rem`},children:[b.categoria&&(0,o.jsx)(`span`,{className:`kb-tag`,children:b.categoria}),(0,o.jsxs)(`span`,{children:[`por `,b.autor?.nome||`AnÃ´nimo`]}),(0,o.jsx)(`span`,{children:M(b.created_at)})]})]}),(0,o.jsxs)(`div`,{className:`kb-solutions-header`,children:[(0,o.jsxs)(`h3`,{className:`kb-solutions-title`,children:[`ðŸ’¡ SoluÃ§Ãµes (`,S.length,`)`]}),(0,o.jsxs)(`button`,{className:`btn-primary`,onClick:()=>T(!0),children:[(0,o.jsx)(s,{}),` Contribuir`]})]}),S.length===0?(0,o.jsx)(`div`,{className:`empty-state`,children:(0,o.jsx)(`p`,{className:`empty-description`,children:`Nenhuma soluÃ§Ã£o ainda. Seja o primeiro a contribuir! ðŸ†`})}):S.map((e,t)=>(0,o.jsxs)(`div`,{className:`kb-solution-card ${t===0&&e.utilidade_score>0?`best`:``}`,children:[(0,o.jsxs)(`div`,{className:`kb-vote-controls`,children:[(0,o.jsx)(`button`,{className:`kb-vote-btn ${e.voto_usuario===1?`voted-up`:``}`,onClick:()=>A(e.id,1),title:`Ãštil`,children:`â–²`}),(0,o.jsx)(`span`,{className:`kb-vote-score`,children:e.utilidade_score}),(0,o.jsx)(`button`,{className:`kb-vote-btn ${e.voto_usuario===-1?`voted-down`:``}`,onClick:()=>A(e.id,-1),title:`NÃ£o ajudou`,children:`â–¼`})]}),(0,o.jsxs)(`div`,{className:`kb-solution-body`,children:[(0,o.jsx)(`div`,{className:`kb-solution-content`,children:e.conteudo}),(0,o.jsxs)(`div`,{className:`kb-solution-meta`,children:[t===0&&e.utilidade_score>0&&(0,o.jsx)(`span`,{style:{color:`#16a34a`,fontWeight:600},children:`âœ… Melhor SoluÃ§Ã£o Â· `}),`por `,e.autor?.nome||`AnÃ´nimo`,` Â· `,M(e.created_at)]})]})]},e.id)),w&&(0,o.jsx)(f,{artigoId:b.id,onClose:()=>T(!1),onSave:()=>{T(!1),O(b.id)}})]}):(0,o.jsxs)(`div`,{className:`kb-page`,children:[(0,o.jsxs)(`div`,{className:`kb-header`,children:[(0,o.jsx)(`h1`,{className:`kb-title`,children:`Base de Conhecimento`}),(0,o.jsxs)(`button`,{className:`btn-primary`,onClick:()=>y(!0),children:[(0,o.jsx)(s,{}),` Novo Problema`]})]}),(0,o.jsxs)(`div`,{className:`kb-tabs`,children:[(0,o.jsx)(`button`,{className:`kb-tab ${e===`artigos`?`active`:``}`,onClick:()=>t(`artigos`),children:`Problemas & SoluÃ§Ãµes`}),(0,o.jsx)(`button`,{className:`kb-tab ${e===`ranking`?`active`:``}`,onClick:()=>t(`ranking`),children:`ðŸ† Ranking`})]}),e===`artigos`&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(`div`,{className:`kb-search`,children:(0,o.jsx)(`input`,{type:`text`,placeholder:`Buscar problemas, soluÃ§Ãµes ou palavras-chave...`,value:g,onChange:e=>_(e.target.value)})}),m?(0,o.jsx)(`div`,{className:`loading-spinner`,children:(0,o.jsx)(`div`,{className:`spinner`})}):n.length===0?(0,o.jsxs)(`div`,{className:`empty-state`,children:[(0,o.jsx)(`div`,{className:`empty-icon`,children:(0,o.jsx)(u,{})}),(0,o.jsx)(`h3`,{className:`empty-title`,children:`Nenhum artigo encontrado`}),(0,o.jsx)(`p`,{className:`empty-description`,children:`Comece registrando um problema para a equipe ajudar a resolver.`})]}):n.map(e=>(0,o.jsxs)(`div`,{className:`kb-article-card`,onClick:()=>k(e),children:[(0,o.jsx)(`div`,{className:`kb-article-title`,children:e.titulo}),(0,o.jsx)(`div`,{className:`kb-article-desc`,children:e.descricao}),(0,o.jsxs)(`div`,{className:`kb-article-meta`,children:[e.categoria&&(0,o.jsx)(`span`,{className:`kb-tag`,children:e.categoria}),(0,o.jsxs)(`span`,{children:[`por `,e.autor?.nome||`AnÃ´nimo`]}),(0,o.jsx)(`span`,{children:M(e.created_at)})]})]},e.id))]}),e===`ranking`&&(0,o.jsxs)(`div`,{className:`kb-leaderboard`,children:[(0,o.jsx)(`div`,{className:`kb-leaderboard-title`,children:`ðŸ… Ranking dos TÃ©cnicos`}),c.length===0?(0,o.jsx)(`div`,{className:`empty-state`,style:{padding:`2rem`},children:(0,o.jsx)(`p`,{className:`empty-description`,children:`Nenhuma pontuaÃ§Ã£o registrada ainda.`})}):c.map((e,t)=>(0,o.jsxs)(`div`,{className:`kb-rank-item`,children:[(0,o.jsxs)(`div`,{className:`kb-rank-pos ${N(t)}`,children:[t+1,`Âº`]}),(0,o.jsx)(`div`,{className:`kb-rank-name`,children:e.usuario?.nome||`TÃ©cnico`}),(0,o.jsxs)(`div`,{className:`kb-rank-score`,children:[e.pontos_totais,` pts`]}),(0,o.jsxs)(`div`,{className:`kb-rank-contributions`,children:[e.contribuicoes_count,` contribuiÃ§Ãµes`]})]},e.usuario_id))]}),v&&(0,o.jsx)(d,{onClose:()=>y(!1),onSave:()=>{y(!1),E()}})]})}export{p as ConhecimentoPage,p as default};