import{c as e,n as t,o as n,r}from"./index-C9yBzEdM.js";/* empty css                 */import{t as i}from"./clientesService-BnZzC_Tg.js";/* empty css                  */var a=e(n(),1);const o={async listar(){let{data:e,error:n}=await t.from(`contratos`).select(`
        *,
        cliente:clientes(id, nome)
      `).order(`nome`);if(n)throw n;return e||[]},async buscarPorId(e){let{data:n,error:r}=await t.from(`contratos`).select(`
        *,
        cliente:clientes(id, nome)
      `).eq(`id`,e).single();if(r)throw r;return n},async criar(e){let{data:{user:n}}=await t.auth.getUser();if(!n)throw Error(`Usuário não autenticado`);let{data:r}=await t.from(`perfis`).select(`empresa_id`).eq(`id`,n.id).single();if(!r?.empresa_id)throw Error(`Empresa não encontrada`);let{data:i,error:a}=await t.from(`contratos`).insert([{...e,empresa_id:r.empresa_id}]).select().single();if(a)throw a;return i},async atualizar(e,n){let{data:r,error:i}=await t.from(`contratos`).update(n).eq(`id`,e).select().single();if(i)throw i;return r},async excluir(e){let{error:n}=await t.from(`contratos`).delete().eq(`id`,e);if(n)throw n}};var s=r(),c=()=>(0,s.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,s.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),l=()=>(0,s.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`path`,{d:`M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`}),(0,s.jsx)(`path`,{d:`M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z`})]}),u=()=>(0,s.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`polyline`,{points:`3 6 5 6 21 6`}),(0,s.jsx)(`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`})]}),d=()=>(0,s.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,s.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),f=()=>(0,s.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`path`,{d:`M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z`}),(0,s.jsx)(`polyline`,{points:`14 2 14 8 20 8`}),(0,s.jsx)(`line`,{x1:`16`,y1:`13`,x2:`8`,y2:`13`}),(0,s.jsx)(`line`,{x1:`16`,y1:`17`,x2:`8`,y2:`17`}),(0,s.jsx)(`polyline`,{points:`10 9 9 9 8 9`})]});function p({contrato:e,clientes:t,onClose:n,onSave:r}){let[i,c]=(0,a.useState)({nome:e?.nome||``,cliente_id:e?.cliente_id||``,valor:e?.valor||0,dia_vencimento:e?.dia_vencimento||5,data_inicio:e?.data_inicio||new Date().toISOString().split(`T`)[0],data_fim:e?.data_fim||``,descricao:e?.descricao||``,ativo:e?.ativo??!0}),[l,u]=(0,a.useState)(!1),[f,p]=(0,a.useState)(``);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:n,children:(0,s.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsx)(`h2`,{className:`modal-title`,children:e?`Editar Contrato`:`Novo Contrato`}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:n,children:(0,s.jsx)(d,{})})]}),(0,s.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),u(!0),p(``);try{e?await o.atualizar(e.id,i):await o.criar(i),r()}catch(e){p(`Erro ao salvar contrato.`),console.error(e)}finally{u(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[f&&(0,s.jsx)(`div`,{className:`error-message`,children:f}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Nome do Contrato *`}),(0,s.jsx)(`input`,{type:`text`,className:`form-input`,value:i.nome,onChange:e=>c({...i,nome:e.target.value}),placeholder:`Ex: Manutenção Mensal - Sede`,required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Cliente *`}),(0,s.jsxs)(`select`,{className:`form-select`,value:i.cliente_id,onChange:e=>c({...i,cliente_id:e.target.value}),required:!0,children:[(0,s.jsx)(`option`,{value:``,children:`Selecione um cliente...`}),t.map(e=>(0,s.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Valor Mensal (R$)`}),(0,s.jsx)(`input`,{type:`number`,step:`0.01`,className:`form-input`,value:i.valor,onChange:e=>c({...i,valor:parseFloat(e.target.value)}),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Dia Vencimento`}),(0,s.jsx)(`input`,{type:`number`,min:`1`,max:`31`,className:`form-input`,value:i.dia_vencimento,onChange:e=>c({...i,dia_vencimento:parseInt(e.target.value)}),required:!0})]})]}),(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Data Início`}),(0,s.jsx)(`input`,{type:`date`,className:`form-input`,value:i.data_inicio,onChange:e=>c({...i,data_inicio:e.target.value}),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Data Fim (Opcional)`}),(0,s.jsx)(`input`,{type:`date`,className:`form-input`,value:i.data_fim||``,onChange:e=>c({...i,data_fim:e.target.value})})]})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Descrição / Observações`}),(0,s.jsx)(`textarea`,{className:`form-input`,value:i.descricao||``,onChange:e=>c({...i,descricao:e.target.value}),rows:3})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:n,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:l,children:l?`Salvando...`:`Salvar`})]})]})]})})}function m(){let[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)([]),[d,m]=(0,a.useState)(!0),[h,g]=(0,a.useState)(!1),[_,v]=(0,a.useState)(null),y=async()=>{try{m(!0);let[e,n]=await Promise.all([o.listar(),i.listar()]);t(e),r(n)}catch(e){console.error(`Erro ao carregar dados:`,e)}finally{m(!1)}};(0,a.useEffect)(()=>{y()},[]);let b=()=>{v(null),g(!0)},x=e=>{v(e),g(!0)},S=async e=>{if(window.confirm(`Tem certeza que deseja excluir este contrato?`))try{await o.excluir(e),y()}catch(e){console.error(`Erro ao excluir:`,e)}},C=e=>new Intl.NumberFormat(`pt-BR`,{style:`currency`,currency:`BRL`}).format(e);return(0,s.jsxs)(`div`,{className:`contratos-page`,children:[(0,s.jsxs)(`div`,{className:`contratos-header`,children:[(0,s.jsx)(`h1`,{className:`contratos-title`,children:`Contratos`}),(0,s.jsxs)(`button`,{className:`btn-primary`,onClick:b,children:[(0,s.jsx)(c,{}),` Novo Contrato`]})]}),d?(0,s.jsx)(`div`,{className:`loading-spinner`,children:(0,s.jsx)(`div`,{className:`spinner`})}):e.length===0?(0,s.jsxs)(`div`,{className:`empty-state`,children:[(0,s.jsx)(`div`,{className:`empty-icon`,children:(0,s.jsx)(f,{})}),(0,s.jsx)(`h3`,{className:`empty-title`,children:`Nenhum contrato encontrado`}),(0,s.jsx)(`p`,{className:`empty-description`,children:`Cadastre contratos de manutenção recorrente.`})]}):(0,s.jsx)(`div`,{className:`table-container`,children:(0,s.jsxs)(`table`,{className:`data-table`,children:[(0,s.jsx)(`thead`,{children:(0,s.jsxs)(`tr`,{children:[(0,s.jsx)(`th`,{children:`Nome`}),(0,s.jsx)(`th`,{children:`Cliente`}),(0,s.jsx)(`th`,{children:`Valor`}),(0,s.jsx)(`th`,{children:`Vencimento`}),(0,s.jsx)(`th`,{children:`Status`}),(0,s.jsx)(`th`,{children:`Ações`})]})}),(0,s.jsx)(`tbody`,{children:e.map(e=>(0,s.jsxs)(`tr`,{children:[(0,s.jsxs)(`td`,{children:[(0,s.jsx)(`div`,{className:`table-name`,children:e.nome}),(0,s.jsx)(`div`,{style:{fontSize:`0.8rem`,color:`#666`},children:e.descricao})]}),(0,s.jsx)(`td`,{children:e.cliente?.nome}),(0,s.jsx)(`td`,{children:C(e.valor)}),(0,s.jsxs)(`td`,{children:[`Dia `,e.dia_vencimento]}),(0,s.jsx)(`td`,{children:(0,s.jsx)(`span`,{className:e.ativo?`badge-ativo`:`badge-inativo`,children:e.ativo?`Ativo`:`Inativo`})}),(0,s.jsx)(`td`,{children:(0,s.jsxs)(`div`,{className:`table-actions`,children:[(0,s.jsx)(`button`,{className:`btn-icon`,onClick:()=>x(e),children:(0,s.jsx)(l,{})}),(0,s.jsx)(`button`,{className:`btn-icon danger`,onClick:()=>S(e.id),children:(0,s.jsx)(u,{})})]})})]},e.id))})]})}),h&&(0,s.jsx)(p,{contrato:_,clientes:n,onClose:()=>g(!1),onSave:()=>{g(!1),y()}})]})}export{m as ContratosPage,m as default};