import{c as e,n as t,o as n,r,t as i}from"./index-C9yBzEdM.js";/* empty css                 */import{t as a}from"./clientesService-BnZzC_Tg.js";/* empty css                  */var o=e(n(),1);const s={async listarFaturas(e){let{data:n,error:r}=await t.from(`faturas`).select(`
                *,
                cliente:clientes(nome),
                contrato:contratos(nome),
                ordem_servico:ordens_servico(numero)
            `).eq(`empresa_id`,e).order(`data_vencimento`,{ascending:!0});if(r)throw r;return n||[]},async criarFatura(e){let{data:n,error:r}=await t.from(`faturas`).insert(e).select().single();if(r)throw r;return n},async atualizarStatusFatura(e,n,r){let{data:i,error:a}=await t.from(`faturas`).update({status:n,data_pagamento:r||(n===`pago`?new Date().toISOString():null)}).eq(`id`,e).select().single();if(a)throw a;return i},async excluirFatura(e){let{error:n}=await t.from(`faturas`).delete().eq(`id`,e);if(n)throw n}};var c=r(),l=()=>(0,c.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,c.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,c.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),u=()=>(0,c.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,c.jsx)(`polyline`,{points:`3 6 5 6 21 6`}),(0,c.jsx)(`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`})]}),d=()=>(0,c.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,c.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,c.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),f=()=>(0,c.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,c.jsx)(`line`,{x1:`12`,y1:`1`,x2:`12`,y2:`23`}),(0,c.jsx)(`path`,{d:`M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6`})]});function p({clientes:e,empresaId:t,onClose:n,onSave:r}){let[i,a]=(0,o.useState)({descricao:``,cliente_id:``,valor:0,data_vencimento:new Date().toISOString().split(`T`)[0],status:`pendente`,empresa_id:t}),[l,u]=(0,o.useState)(!1),[f,p]=(0,o.useState)(``);return(0,c.jsx)(`div`,{className:`modal-overlay`,onClick:n,children:(0,c.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)(`div`,{className:`modal-header`,children:[(0,c.jsx)(`h2`,{className:`modal-title`,children:`Nova Fatura`}),(0,c.jsx)(`button`,{className:`modal-close`,onClick:n,children:(0,c.jsx)(d,{})})]}),(0,c.jsxs)(`form`,{onSubmit:async e=>{e.preventDefault(),u(!0),p(``);try{await s.criarFatura(i),r()}catch(e){p(`Erro ao criar fatura.`),console.error(e)}finally{u(!1)}},children:[(0,c.jsxs)(`div`,{className:`modal-body`,children:[f&&(0,c.jsx)(`div`,{className:`error-message`,children:f}),(0,c.jsxs)(`div`,{className:`form-group`,children:[(0,c.jsx)(`label`,{className:`form-label`,children:`Descrição *`}),(0,c.jsx)(`input`,{type:`text`,className:`form-input`,value:i.descricao,onChange:e=>a({...i,descricao:e.target.value}),placeholder:`Ex: Manutenção Mensal - Maio/2026`,required:!0})]}),(0,c.jsxs)(`div`,{className:`form-group`,children:[(0,c.jsx)(`label`,{className:`form-label`,children:`Cliente *`}),(0,c.jsxs)(`select`,{className:`form-select`,value:i.cliente_id,onChange:e=>a({...i,cliente_id:e.target.value}),required:!0,children:[(0,c.jsx)(`option`,{value:``,children:`Selecione um cliente...`}),e.map(e=>(0,c.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,c.jsxs)(`div`,{className:`form-row`,children:[(0,c.jsxs)(`div`,{className:`form-group`,children:[(0,c.jsx)(`label`,{className:`form-label`,children:`Valor (R$)`}),(0,c.jsx)(`input`,{type:`number`,step:`0.01`,className:`form-input`,value:i.valor,onChange:e=>a({...i,valor:parseFloat(e.target.value)}),required:!0})]}),(0,c.jsxs)(`div`,{className:`form-group`,children:[(0,c.jsx)(`label`,{className:`form-label`,children:`Vencimento`}),(0,c.jsx)(`input`,{type:`date`,className:`form-input`,value:i.data_vencimento,onChange:e=>a({...i,data_vencimento:e.target.value}),required:!0})]})]}),(0,c.jsxs)(`div`,{className:`form-group`,children:[(0,c.jsx)(`label`,{className:`form-label`,children:`Status Inicial`}),(0,c.jsxs)(`select`,{className:`form-select`,value:i.status,onChange:e=>a({...i,status:e.target.value}),children:[(0,c.jsx)(`option`,{value:`pendente`,children:`Pendente`}),(0,c.jsx)(`option`,{value:`pago`,children:`Pago`})]})]})]}),(0,c.jsxs)(`div`,{className:`modal-footer`,children:[(0,c.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:n,children:`Cancelar`}),(0,c.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:l,children:l?`Criar Fatura`:`Criar`})]})]})]})})}function m(){let{userProfile:e}=i(),[t,n]=(0,o.useState)([]),[r,d]=(0,o.useState)([]),[m,h]=(0,o.useState)(!0),[g,_]=(0,o.useState)(!1),v=async()=>{if(!e?.empresa_id){h(!1);return}try{h(!0);let[t,r]=await Promise.all([s.listarFaturas(e.empresa_id),a.listar()]);n(t),d(r)}catch(e){console.error(`Erro ao carregar dados:`,e)}finally{h(!1)}};(0,o.useEffect)(()=>{v()},[e?.empresa_id]);let y=()=>{_(!0)},b=async e=>{if(window.confirm(`Tem certeza que deseja excluir esta fatura?`))try{await s.excluirFatura(e),v()}catch(e){console.error(`Erro ao excluir:`,e)}},x=async(e,t)=>{try{await s.atualizarStatusFatura(e,t),v()}catch(e){console.error(`Erro ao atualizar status:`,e)}},S=e=>new Intl.NumberFormat(`pt-BR`,{style:`currency`,currency:`BRL`}).format(e),C=e=>e?new Date(e).toLocaleDateString(`pt-BR`):`-`,w=e=>{switch(e){case`pago`:return{backgroundColor:`#dcfce7`,color:`#166534`,padding:`4px 8px`,borderRadius:`4px`,fontSize:`12px`,fontWeight:`500`};case`pendente`:return{backgroundColor:`#fef9c3`,color:`#854d0e`,padding:`4px 8px`,borderRadius:`4px`,fontSize:`12px`,fontWeight:`500`};case`atrasado`:return{backgroundColor:`#fee2e2`,color:`#991b1b`,padding:`4px 8px`,borderRadius:`4px`,fontSize:`12px`,fontWeight:`500`};case`cancelado`:return{backgroundColor:`#f1f5f9`,color:`#64748b`,padding:`4px 8px`,borderRadius:`4px`,fontSize:`12px`,fontWeight:`500`};default:return{}}};return(0,c.jsxs)(`div`,{className:`contratos-page`,children:[(0,c.jsxs)(`div`,{className:`contratos-header`,children:[(0,c.jsx)(`h1`,{className:`contratos-title`,children:`Faturamento`}),(0,c.jsxs)(`button`,{className:`btn-primary`,onClick:y,children:[(0,c.jsx)(l,{}),` Nova Fatura`]})]}),m?(0,c.jsx)(`div`,{className:`loading-spinner`,children:(0,c.jsx)(`div`,{className:`spinner`})}):t.length===0?(0,c.jsxs)(`div`,{className:`empty-state`,children:[(0,c.jsx)(`div`,{className:`empty-icon`,children:(0,c.jsx)(f,{})}),(0,c.jsx)(`h3`,{className:`empty-title`,children:`Nenhuma fatura encontrada`}),(0,c.jsx)(`p`,{className:`empty-description`,children:`Gerencie as cobranças dos seus serviços e contratos.`})]}):(0,c.jsx)(`div`,{className:`table-container`,children:(0,c.jsxs)(`table`,{className:`data-table`,children:[(0,c.jsx)(`thead`,{children:(0,c.jsxs)(`tr`,{children:[(0,c.jsx)(`th`,{children:`Descrição`}),(0,c.jsx)(`th`,{children:`Cliente`}),(0,c.jsx)(`th`,{children:`Valor`}),(0,c.jsx)(`th`,{children:`Vencimento`}),(0,c.jsx)(`th`,{children:`Pagamento`}),(0,c.jsx)(`th`,{children:`Status`}),(0,c.jsx)(`th`,{children:`Ações`})]})}),(0,c.jsx)(`tbody`,{children:t.map(e=>(0,c.jsxs)(`tr`,{children:[(0,c.jsxs)(`td`,{children:[(0,c.jsx)(`div`,{className:`table-name`,children:e.descricao}),e.contrato?.nome&&(0,c.jsxs)(`div`,{style:{fontSize:`0.8rem`,color:`#666`},children:[`Contrato: `,e.contrato.nome]})]}),(0,c.jsx)(`td`,{children:e.cliente?.nome}),(0,c.jsx)(`td`,{children:S(e.valor)}),(0,c.jsx)(`td`,{children:C(e.data_vencimento)}),(0,c.jsx)(`td`,{children:C(e.data_pagamento||``)}),(0,c.jsx)(`td`,{children:(0,c.jsx)(`span`,{style:w(e.status),children:e.status.toUpperCase()})}),(0,c.jsx)(`td`,{children:(0,c.jsxs)(`div`,{className:`table-actions`,children:[e.status===`pendente`&&(0,c.jsx)(`button`,{className:`btn-icon`,title:`Marcar como Pago`,onClick:()=>x(e.id,`pago`),style:{color:`#166534`},children:`✓`}),(0,c.jsx)(`button`,{className:`btn-icon danger`,onClick:()=>b(e.id),children:(0,c.jsx)(u,{})})]})})]},e.id))})]})}),g&&e?.empresa_id&&(0,c.jsx)(p,{clientes:r,empresaId:e.empresa_id,onClose:()=>_(!1),onSave:()=>{_(!1),v()}})]})}export{m as FaturamentoPage,m as default};