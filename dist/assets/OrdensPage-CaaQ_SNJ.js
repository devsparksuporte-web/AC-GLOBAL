import{c as e,i as t,o as n,r,t as i}from"./index-C9yBzEdM.js";import{t as a}from"./adminService-DRZDLqYL.js";/* empty css                 */import"./conformidadeService-DTfsGcFE.js";import{t as o}from"./ordensService-CQbPUMAW.js";import{t as s}from"./clientesService-BnZzC_Tg.js";import{t as c}from"./transparentService-CwEGEg_3.js";import{t as l}from"./estoqueService-7b9QeiRZ.js";/* empty css               */var u=e(n(),1),d=r();function f({onClose:e}){let[t,n]=(0,u.useState)(0),[r,i]=(0,u.useState)(1),[a,o]=(0,u.useState)(0),[s,c]=(0,u.useState)(`pouca`),l=(()=>{if(t<=0)return 0;let e=s===`pouca`?600:800,n=t*e;return r>1&&(n+=(r-1)*e),n+=a*e,n})();return(0,d.jsx)(`div`,{className:`btu-modal-overlay`,children:(0,d.jsxs)(`div`,{className:`btu-modal-content`,children:[(0,d.jsxs)(`div`,{className:`btu-header`,children:[(0,d.jsx)(`h2`,{children:`Calculadora de BTUs`}),(0,d.jsx)(`button`,{className:`close-btn`,onClick:e,children:`Ã—`})]}),(0,d.jsxs)(`div`,{className:`btu-body`,children:[(0,d.jsxs)(`div`,{className:`btu-form-group`,children:[(0,d.jsx)(`label`,{children:`Ãrea do Ambiente (mÂ²)`}),(0,d.jsx)(`input`,{type:`number`,value:t,onChange:e=>n(Number(e.target.value)),placeholder:`Ex: 15`})]}),(0,d.jsxs)(`div`,{className:`btu-form-group`,children:[(0,d.jsx)(`label`,{children:`NÃºmero de Pessoas`}),(0,d.jsx)(`input`,{type:`number`,value:r,onChange:e=>i(Number(e.target.value)),min:`1`})]}),(0,d.jsxs)(`div`,{className:`btu-form-group`,children:[(0,d.jsx)(`label`,{children:`Aparelhos EletrÃ´nicos`}),(0,d.jsx)(`input`,{type:`number`,value:a,onChange:e=>o(Number(e.target.value)),min:`0`})]}),(0,d.jsxs)(`div`,{className:`btu-form-group`,children:[(0,d.jsx)(`label`,{children:`ExposiÃ§Ã£o ao Sol`}),(0,d.jsxs)(`div`,{className:`radio-group`,children:[(0,d.jsx)(`button`,{className:`radio-btn ${s===`pouca`?`active`:``}`,onClick:()=>c(`pouca`),children:`Pouca / ManhÃ£`}),(0,d.jsx)(`button`,{className:`radio-btn ${s===`muita`?`active`:``}`,onClick:()=>c(`muita`),children:`Muita / Tarde`})]})]}),(0,d.jsxs)(`div`,{className:`btu-result-card`,children:[(0,d.jsx)(`div`,{className:`result-label`,children:`CÃ¡lculo NecessÃ¡rio`}),(0,d.jsxs)(`div`,{className:`result-value`,children:[l.toLocaleString(),` BTU/h`]}),(0,d.jsxs)(`div`,{className:`result-suggestion`,children:[(0,d.jsx)(`strong`,{children:`SugestÃ£o:`}),` `,(e=>e<=9e3?`9.000 BTU/h`:e<=12e3?`12.000 BTU/h`:e<=18e3?`18.000 BTU/h`:e<=24e3?`24.000 BTU/h`:e<=3e4?`30.000 BTU/h`:`Considere sistemas Multi-Split ou VRF`)(l)]})]})]}),(0,d.jsx)(`div`,{className:`btu-footer`,children:(0,d.jsx)(`p`,{children:`Nota: Este cÃ¡lculo Ã© uma estimativa tÃ©cnica bÃ¡sica.`})})]})})}function p({onSave:e,onCancel:t}){let n=(0,u.useRef)(null),[r,i]=(0,u.useState)(!1),[a,o]=(0,u.useState)(!0);(0,u.useEffect)(()=>{let e=n.current;if(!e)return;let t=e.getContext(`2d`);if(!t)return;t.strokeStyle=`#000`,t.lineWidth=3,t.lineCap=`round`,t.lineJoin=`round`;let r=window.devicePixelRatio||1;e.width=e.offsetWidth*r,e.height=e.offsetHeight*r,t.scale(r,r)},[]);let s=e=>{i(!0),o(!1);let{x:t,y:r}=f(e),a=n.current?.getContext(`2d`);a&&(a.beginPath(),a.moveTo(t,r))},c=e=>{if(!r)return;let{x:t,y:i}=f(e),a=n.current?.getContext(`2d`);a&&(a.lineTo(t,i),a.stroke())},l=()=>{i(!1)},f=e=>{let t=n.current;if(!t)return{x:0,y:0};let r=t.getBoundingClientRect(),i,a;return`touches`in e?(i=e.touches[0].clientX,a=e.touches[0].clientY):(i=e.clientX,a=e.clientY),{x:i-r.left,y:a-r.top}};return(0,d.jsx)(`div`,{className:`signature-overlay`,children:(0,d.jsxs)(`div`,{className:`signature-container`,children:[(0,d.jsxs)(`div`,{className:`signature-header`,children:[(0,d.jsx)(`h3`,{children:`Assinatura do Cliente`}),(0,d.jsx)(`p`,{children:`Por favor, assine no campo abaixo`})]}),(0,d.jsx)(`canvas`,{ref:n,className:`signature-canvas`,onMouseDown:s,onMouseMove:c,onMouseUp:l,onMouseLeave:l,onTouchStart:s,onTouchMove:c,onTouchEnd:l}),(0,d.jsxs)(`div`,{className:`signature-actions`,children:[(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:t,children:`Cancelar`}),(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:()=>{let e=n.current,t=e?.getContext(`2d`);e&&t&&(t.clearRect(0,0,e.width,e.height),o(!0))},children:`Limpar`}),(0,d.jsx)(`button`,{className:`btn-primary`,onClick:()=>{if(a)return;let t=n.current;t&&e(t.toDataURL(`image/png`))},disabled:a,children:`Confirmar Assinatura`})]})]})})}var m=()=>(0,d.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,d.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),h=()=>(0,d.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`path`,{d:`M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`}),(0,d.jsx)(`path`,{d:`M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z`})]}),g=()=>(0,d.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`polyline`,{points:`3 6 5 6 21 6`}),(0,d.jsx)(`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`})]}),_=()=>(0,d.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,d.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),v=()=>(0,d.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`rect`,{x:`8`,y:`2`,width:`8`,height:`4`,rx:`1`,ry:`1`}),(0,d.jsx)(`path`,{d:`M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2`})]}),y=()=>(0,d.jsxs)(`svg`,{width:`32`,height:`32`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`path`,{d:`M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z`}),(0,d.jsx)(`line`,{x1:`12`,y1:`9`,x2:`12`,y2:`13`}),(0,d.jsx)(`line`,{x1:`12`,y1:`17`,x2:`12.01`,y2:`17`})]}),b=[{value:`instalacao`,label:`InstalaÃ§Ã£o`},{value:`manutencao`,label:`ManutenÃ§Ã£o`},{value:`reparo`,label:`Reparo`},{value:`limpeza`,label:`Limpeza`}],x=[{value:`aberta`,label:`Aberta`},{value:`em_andamento`,label:`Em Andamento`},{value:`concluida`,label:`ConcluÃ­da`},{value:`cancelada`,label:`Cancelada`}],S=[{value:`baixa`,label:`Baixa`},{value:`normal`,label:`Normal`},{value:`alta`,label:`Alta`},{value:`urgente`,label:`Urgente`}];function C({ordem:e,clientes:t,tecnicos:n,onClose:r,onSave:i}){let[a,s]=(0,u.useState)({cliente_id:e?.cliente_id||``,tipo:e?.tipo||`manutencao`,status:e?.status||`aberta`,prioridade:e?.prioridade||`normal`,descricao:e?.descricao||``,equipamento:e?.equipamento||``,valor:e?.valor||void 0,data_agendamento:e?.data_agendamento?.split(`T`)[0]||``,tecnico_responsavel:e?.tecnico_responsavel||``,observacoes:e?.observacoes||``}),[c,l]=(0,u.useState)(!1),[f,p]=(0,u.useState)(``);return(0,d.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,d.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`600px`},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)(`div`,{className:`modal-header`,children:[(0,d.jsx)(`h2`,{className:`modal-title`,children:e?`Editar OS #${e.numero}`:`Nova Ordem de ServiÃ§o`}),(0,d.jsx)(`button`,{className:`modal-close`,onClick:r,children:(0,d.jsx)(_,{})})]}),(0,d.jsxs)(`form`,{onSubmit:async t=>{if(t.preventDefault(),!a.cliente_id){p(`Selecione um cliente`);return}l(!0),p(``);try{let t={...a,data_agendamento:a.data_agendamento?`${a.data_agendamento}T09:00:00`:void 0};e?await o.atualizar(e.id,t):await o.criar(t),i()}catch{p(`Erro ao salvar ordem. Tente novamente.`)}finally{l(!1)}},children:[(0,d.jsxs)(`div`,{className:`modal-body`,children:[f&&(0,d.jsx)(`div`,{className:`error-message`,style:{marginBottom:`1rem`},children:f}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Cliente *`}),(0,d.jsxs)(`select`,{className:`form-input`,value:a.cliente_id,onChange:e=>s({...a,cliente_id:e.target.value}),disabled:c,children:[(0,d.jsx)(`option`,{value:``,children:`Selecione um cliente`}),t.map(e=>(0,d.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,d.jsxs)(`div`,{className:`form-row`,children:[(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Tipo`}),(0,d.jsx)(`select`,{className:`form-input`,value:a.tipo,onChange:e=>s({...a,tipo:e.target.value}),disabled:c,children:b.map(e=>(0,d.jsx)(`option`,{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Prioridade`}),(0,d.jsx)(`select`,{className:`form-input`,value:a.prioridade,onChange:e=>s({...a,prioridade:e.target.value}),disabled:c,children:S.map(e=>(0,d.jsx)(`option`,{value:e.value,children:e.label},e.value))})]})]}),e&&(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Status`}),(0,d.jsx)(`select`,{className:`form-input`,value:a.status,onChange:e=>s({...a,status:e.target.value}),disabled:c,children:x.map(e=>(0,d.jsx)(`option`,{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Equipamento`}),(0,d.jsx)(`input`,{type:`text`,className:`form-input`,value:a.equipamento,onChange:e=>s({...a,equipamento:e.target.value}),placeholder:`Ex: Split 12000 BTUs LG`,disabled:c})]}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`DescriÃ§Ã£o do ServiÃ§o`}),(0,d.jsx)(`textarea`,{className:`form-input`,value:a.descricao,onChange:e=>s({...a,descricao:e.target.value}),placeholder:`Descreva o serviÃ§o a ser realizado...`,disabled:c})]}),(0,d.jsxs)(`div`,{className:`form-row`,children:[(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Data Agendamento`}),(0,d.jsx)(`input`,{type:`date`,className:`form-input`,value:a.data_agendamento,onChange:e=>s({...a,data_agendamento:e.target.value}),disabled:c})]}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`Valor (R$)`}),(0,d.jsx)(`input`,{type:`number`,step:`0.01`,className:`form-input`,value:a.valor||``,onChange:e=>s({...a,valor:parseFloat(e.target.value)||void 0}),placeholder:`0,00`,disabled:c})]})]}),(0,d.jsxs)(`div`,{className:`form-group`,children:[(0,d.jsx)(`label`,{className:`form-label`,children:`TÃ©cnico ResponsÃ¡vel *`}),(0,d.jsxs)(`select`,{className:`form-input`,value:a.tecnico_id||``,onChange:e=>s({...a,tecnico_id:e.target.value}),disabled:c,required:!0,children:[(0,d.jsx)(`option`,{value:``,children:`Selecione um tÃ©cnico`}),n.map(e=>(0,d.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,d.jsxs)(`div`,{className:`form-group`,style:{marginTop:`1.5rem`},children:[(0,d.jsx)(`label`,{className:`form-label`,children:`ObservaÃ§Ãµes`}),(0,d.jsx)(`textarea`,{className:`form-input`,value:a.observacoes,onChange:e=>s({...a,observacoes:e.target.value}),placeholder:`ObservaÃ§Ãµes adicionais...`,disabled:c})]})]}),(0,d.jsxs)(`div`,{className:`modal-footer`,children:[(0,d.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:r,disabled:c,children:`Cancelar`}),(0,d.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:c,children:c?`Salvando...`:e?`Salvar AlteraÃ§Ãµes`:`Criar Ordem`})]})]})]})})}function w({title:e,message:t,onConfirm:n,onCancel:r,loading:i}){return(0,d.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,d.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`400px`},onClick:e=>e.stopPropagation(),children:[(0,d.jsx)(`div`,{className:`modal-body`,children:(0,d.jsxs)(`div`,{className:`confirm-dialog`,children:[(0,d.jsx)(`div`,{className:`confirm-icon`,children:(0,d.jsx)(y,{})}),(0,d.jsx)(`h3`,{className:`confirm-title`,children:e}),(0,d.jsx)(`p`,{className:`confirm-message`,children:t})]})}),(0,d.jsxs)(`div`,{className:`modal-footer`,children:[(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:r,disabled:i,children:`Cancelar`}),(0,d.jsx)(`button`,{className:`btn-primary btn-danger`,onClick:n,disabled:i,children:i?`Excluindo...`:`Excluir`})]})]})})}function T(e){return e?new Date(e).toLocaleDateString(`pt-BR`):`-`}function E(e){return x.find(t=>t.value===e)?.label||e}function D(e){return b.find(t=>t.value===e)?.label||e}function O({ordem:e,onClose:t,onUpdate:n}){let[r,a]=(0,u.useState)(!1),[s,f]=(0,u.useState)([]),[m,h]=(0,u.useState)(e.rastreamento_ativo||!1),[g,v]=(0,u.useState)(!1),[y,b]=(0,u.useState)([]),[x,S]=(0,u.useState)([]),C=async()=>{f(await c.listarFotos(e.id))},w=async()=>{b(await l.listar())};(0,u.useEffect)(()=>{C(),w()},[e.id]);let T=()=>{let t=`${window.location.origin}/track/${e.public_id}`;navigator.clipboard.writeText(t),alert(`Link de rastreio copiado para o cliente!`)},E=()=>{if(e.cliente?.telefone){let t=o.getWhatsAppClientLink(e,e.cliente.telefone,`caminho`);window.open(t,`_blank`)}else alert(`Cliente nÃ£o possui telefone cadastrado.`)},{user:D}=i(),O=async()=>{try{a(!0);let t=!m,r={rastreamento_ativo:t};t&&D&&(r.tecnico_id=D.id),await o.atualizar(e.id,r),h(t),t&&navigator.geolocation.getCurrentPosition(async t=>{await c.atualizarLocalizacao(t.coords.latitude,t.coords.longitude),await c.registrarEvento({ordem_id:e.id,empresa_id:e.empresa_id,tipo:`inicio`,descricao:`TÃ©cnico iniciou o rastreamento`,latitude:t.coords.latitude,longitude:t.coords.longitude})}),n()}catch{alert(`Erro ao atualizar rastreio`)}finally{a(!1)}},k=async()=>{a(!0),navigator.geolocation.getCurrentPosition(async t=>{await c.registrarEvento({ordem_id:e.id,empresa_id:e.empresa_id,tipo:`chegada`,descricao:`TÃ©cnico chegou ao local`,latitude:t.coords.latitude,longitude:t.coords.longitude}),a(!1),alert(`Chegada registrada!`)})},A=async(t,n)=>{if(t.target.files?.[0]){a(!0);try{await c.uploadFoto(e.id,t.target.files[0],n,`Foto de ${n}`),C()}catch{alert(`Erro no upload`)}finally{a(!1)}}},j=async r=>{try{a(!0),await c.uploadAssinatura(e.id,r),await o.atualizar(e.id,{status:`concluida`,rastreamento_ativo:!1,data_conclusao:new Date().toISOString()});for(let t of x)await l.registrarMovimentacao({item_id:t.item_id,ordem_id:e.id,tipo:`saida`,quantidade:t.quantidade,motivo:`Uso na OS #${e.numero}`});await c.registrarEvento({ordem_id:e.id,empresa_id:e.empresa_id,tipo:`concluido`,descricao:`ServiÃ§o concluÃ­do e assinado pelo cliente`,latitude:0,longitude:0}),alert(`ServiÃ§o finalizado com sucesso!`),v(!1),n(),t()}catch(e){console.error(e),alert(`Erro ao finalizar serviÃ§o`)}finally{a(!1)}},M=e=>{let t=y.find(t=>t.id===e);t&&S(n=>n.find(t=>t.item_id===e)?n.map(t=>t.item_id===e?{...t,quantidade:t.quantidade+1}:t):[...n,{item_id:e,quantidade:1,nome:t.nome}])};return(0,d.jsxs)(`div`,{className:`modal-overlay`,onClick:t,children:[(0,d.jsxs)(`div`,{className:`modal-content`,style:{maxWidth:`500px`},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)(`div`,{className:`modal-header`,children:[(0,d.jsxs)(`h2`,{className:`modal-title`,children:[`Painel do TÃ©cnico (OS #`,e.numero,`)`]}),(0,d.jsx)(`button`,{className:`modal-close`,onClick:t,children:(0,d.jsx)(_,{})})]}),(0,d.jsxs)(`div`,{className:`modal-body`,children:[(0,d.jsxs)(`div`,{style:{display:`flex`,gap:`1rem`,marginBottom:`1.5rem`},children:[(0,d.jsx)(`button`,{className:`btn-primary ${m?`btn-danger`:``}`,onClick:O,disabled:r,children:m?`Encerrar Rastreio`:`ðŸš€ Iniciar Rastreio`}),(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:T,children:`ðŸ”— Copiar Link`}),(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:E,style:{color:`#25D366`},children:`ðŸ’¬ Zap`})]}),(0,d.jsxs)(`div`,{className:`actions-grid`,style:{display:`grid`,gridTemplateColumns:`1fr 1fr`,gap:`1rem`},children:[(0,d.jsx)(`button`,{className:`btn-secondary`,onClick:k,disabled:r,children:`ðŸ“ Marcar Chegada`}),(0,d.jsx)(`button`,{className:`btn-primary`,onClick:()=>v(!0),disabled:r||e.status===`concluida`,children:`âœï¸ Finalizar (Assinar)`})]}),(0,d.jsxs)(`div`,{className:`upload-btn-wrapper`,style:{position:`relative`,overflow:`hidden`,marginTop:`1rem`},children:[(0,d.jsx)(`button`,{className:`btn-secondary`,style:{width:`100%`},children:`ðŸ“¸ Foto do Problema/ServiÃ§o`}),(0,d.jsx)(`input`,{type:`file`,style:{position:`absolute`,opacity:0,inset:0,cursor:`pointer`},onChange:e=>A(e,`depois`)})]}),(0,d.jsx)(`h4`,{style:{marginTop:`2rem`},children:`PeÃ§as Utilizadas`}),(0,d.jsxs)(`div`,{className:`pecas-control`,style:{marginBottom:`1rem`},children:[(0,d.jsxs)(`select`,{onChange:e=>M(e.target.value),style:{width:`100%`,padding:`0.5rem`,borderRadius:`4px`,border:`1px solid #ddd`},value:``,children:[(0,d.jsx)(`option`,{value:``,disabled:!0,children:`Selecionar peÃ§a do estoque...`}),y.map(e=>(0,d.jsxs)(`option`,{value:e.id,children:[e.nome,` (`,e.quantidade,` `,e.unidade,`)`]},e.id))]}),(0,d.jsx)(`ul`,{style:{listStyle:`none`,padding:0,marginTop:`1rem`,border:`1px solid #f1f5f9`,borderRadius:`4px`},children:x.map(e=>(0,d.jsxs)(`li`,{style:{padding:`0.5rem`,borderBottom:`1px solid #f1f5f9`,display:`flex`,justifyContent:`space-between`,fontSize:`0.85rem`},children:[(0,d.jsx)(`span`,{children:e.nome}),(0,d.jsxs)(`strong`,{children:[e.quantidade,`x`]})]},e.item_id))})]}),(0,d.jsx)(`h4`,{style:{marginTop:`2rem`},children:`Resumo de Fotos`}),(0,d.jsx)(`div`,{style:{display:`flex`,gap:`0.5rem`,overflowX:`auto`,padding:`0.5rem 0`},children:s.map(e=>(0,d.jsx)(`img`,{src:e.url,style:{width:`60px`,height:`60px`,borderRadius:`4px`,objectFit:`cover`}},e.id))})]})]}),g&&(0,d.jsx)(p,{onSave:j,onCancel:()=>v(!1)})]})}function k(){let[e,n]=(0,u.useState)([]),[r,c]=(0,u.useState)([]),[l,p]=(0,u.useState)([]),[_,y]=(0,u.useState)(!0),[b,S]=(0,u.useState)(`todos`),[k,A]=(0,u.useState)(!1),[j,M]=(0,u.useState)(null),[N,P]=(0,u.useState)(null),[F,I]=(0,u.useState)(!1),[L,R]=(0,u.useState)(null),[z,B]=(0,u.useState)(!1),{userProfile:V,user:H}=i(),U=t(),W=V?.role===`admin`||V?.role===`super_admin`;(0,u.useEffect)(()=>{V?.role===`cliente`&&U(`/portal`)},[V,U]);let G=async()=>{try{y(!0);let[e,t,r]=await Promise.all([b===`todos`?o.listar():o.listarPorStatus(b),s.listar(),V?.empresa_id?a.listarUsuariosPorEmpresa(V.empresa_id):Promise.resolve([])]),i=e;!W&&H&&(i=e.filter(e=>e.tecnico_id===H.id||e.status===`aberta`)),n(i),c(t),p(r.filter(e=>e.role===`tecnico`||e.role===`admin`))}catch(e){console.error(`Erro ao carregar dados:`,e)}finally{y(!1)}};(0,u.useEffect)(()=>{G()},[b]);let K=()=>{M(null),A(!0)},q=e=>{M(e),A(!0)},J=async()=>{if(L){B(!0);try{await o.excluir(L.id),R(null),G()}catch(e){console.error(`Erro ao excluir ordem:`,e)}finally{B(!1)}}},Y=()=>{A(!1),M(null)};return(0,d.jsxs)(`div`,{className:`ordens-page`,children:[(0,d.jsxs)(`div`,{className:`page-header`,children:[(0,d.jsx)(`h1`,{className:`page-title`,children:`Ordens de ServiÃ§o`}),(0,d.jsxs)(`div`,{className:`page-actions`,style:{display:`flex`,gap:`0.5rem`},children:[(0,d.jsxs)(`button`,{className:`btn-secondary`,onClick:()=>I(!0),children:[(0,d.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,d.jsx)(`rect`,{x:`4`,y:`2`,width:`16`,height:`20`,rx:`2`,ry:`2`}),(0,d.jsx)(`line`,{x1:`8`,y1:`6`,x2:`16`,y2:`6`}),(0,d.jsx)(`line`,{x1:`16`,y1:`14`,x2:`16`,y2:`18`}),(0,d.jsx)(`path`,{d:`M16 10h.01`}),(0,d.jsx)(`path`,{d:`M12 10h.01`}),(0,d.jsx)(`path`,{d:`M8 10h.01`}),(0,d.jsx)(`path`,{d:`M12 14h.01`}),(0,d.jsx)(`path`,{d:`M8 14h.01`}),(0,d.jsx)(`path`,{d:`M12 18h.01`}),(0,d.jsx)(`path`,{d:`M8 18h.01`})]}),`Calculadora BTU`]}),W&&(0,d.jsxs)(`button`,{className:`btn-primary`,onClick:K,children:[(0,d.jsx)(m,{}),`Nova Ordem`]})]})]}),(0,d.jsx)(`div`,{className:`filters-bar horizontal-scroll hide-scrollbar`,children:(0,d.jsxs)(`div`,{className:`filter-group`,children:[(0,d.jsx)(`span`,{className:`filter-label`,children:`Status:`}),(0,d.jsxs)(`select`,{className:`filter-select`,value:b,onChange:e=>S(e.target.value),children:[(0,d.jsx)(`option`,{value:`todos`,children:`Todos`}),x.map(e=>(0,d.jsx)(`option`,{value:e.value,children:e.label},e.value))]})]})}),_?(0,d.jsx)(`div`,{className:`table-container`,children:(0,d.jsx)(`div`,{className:`loading-spinner`,children:(0,d.jsx)(`div`,{className:`spinner`})})}):e.length===0?(0,d.jsx)(`div`,{className:`table-container`,children:(0,d.jsxs)(`div`,{className:`empty-state`,children:[(0,d.jsx)(`div`,{className:`empty-icon`,children:(0,d.jsx)(v,{})}),(0,d.jsx)(`h3`,{className:`empty-title`,children:b===`todos`?`Nenhuma ordem cadastrada`:`Nenhuma ordem encontrada`}),(0,d.jsx)(`p`,{className:`empty-description`,children:b===`todos`?`Comece criando sua primeira ordem de serviÃ§o`:`Tente filtrar por outro status`}),b===`todos`&&(0,d.jsxs)(`button`,{className:`btn-primary`,onClick:K,children:[(0,d.jsx)(m,{}),`Criar Ordem`]})]})}):(0,d.jsx)(`div`,{className:`table-container`,children:(0,d.jsxs)(`table`,{className:`data-table`,children:[(0,d.jsx)(`thead`,{children:(0,d.jsxs)(`tr`,{children:[(0,d.jsx)(`th`,{children:`NÂº`}),(0,d.jsx)(`th`,{children:`Cliente`}),(0,d.jsx)(`th`,{children:`Tipo`}),(0,d.jsx)(`th`,{children:`Status`}),(0,d.jsx)(`th`,{children:`Prioridade`}),(0,d.jsx)(`th`,{children:`Agendamento`}),(0,d.jsx)(`th`,{children:`AÃ§Ãµes`})]})}),(0,d.jsx)(`tbody`,{children:e.map(e=>(0,d.jsxs)(`tr`,{children:[(0,d.jsxs)(`td`,{className:`order-number`,"data-label":`NÂº`,children:[`#`,e.numero]}),(0,d.jsx)(`td`,{"data-label":`Cliente`,children:(0,d.jsxs)(`div`,{className:`client-cell`,children:[(0,d.jsx)(`span`,{className:`client-name`,children:e.cliente?.nome||`Cliente nÃ£o encontrado`}),(0,d.jsx)(`span`,{className:`client-phone`,children:e.cliente?.telefone||``})]})}),(0,d.jsx)(`td`,{"data-label":`Tipo`,children:(0,d.jsx)(`span`,{className:`tipo-label`,children:D(e.tipo)})}),(0,d.jsx)(`td`,{"data-label":`Status`,children:(0,d.jsx)(`span`,{className:`status-badge ${e.status}`,children:E(e.status)})}),(0,d.jsx)(`td`,{"data-label":`Prioridade`,children:(0,d.jsx)(`span`,{className:`prioridade-badge ${e.prioridade}`,children:e.prioridade})}),(0,d.jsx)(`td`,{className:`date-cell`,"data-label":`Agendamento`,children:T(e.data_agendamento)}),(0,d.jsx)(`td`,{"data-label":`AÃ§Ãµes`,children:(0,d.jsxs)(`div`,{className:`table-actions`,children:[e.status===`aberta`&&(0,d.jsxs)(d.Fragment,{children:[W&&e.tecnico_id&&(0,d.jsx)(`button`,{className:`btn-icon`,onClick:()=>{let t=l.find(t=>t.id===e.tecnico_id);t?.telefone?window.open(o.getWhatsAppTechLink(e,t.telefone,V?.empresa?.nome||`N/A`),`_blank`):alert(`TÃ©cnico nÃ£o possui telefone cadastrado.`)},title:`Notificar TÃ©cnico via WhatsApp`,style:{color:`#25D366`},children:`ðŸ’¬`}),e.tecnico_id===H?.id&&(0,d.jsxs)(`div`,{style:{display:`flex`,gap:`0.2rem`},children:[(0,d.jsx)(`button`,{className:`btn-icon`,onClick:async()=>{confirm(`Deseja aceitar este chamado e informar que estÃ¡ a caminho?`)&&(await o.aceitarOrdem(e.id,`imediato`),e.cliente?.telefone&&window.open(o.getWhatsAppClientLink(e,e.cliente.telefone,`caminho`),`_blank`),G())},title:`Aceitar e Ir Agora`,style:{color:`#10b981`},children:`ðŸš€`}),(0,d.jsx)(`button`,{className:`btn-icon`,onClick:async()=>{confirm(`Deseja aceitar este chamado e confirmar o agendamento?`)&&(await o.aceitarOrdem(e.id,`agendado`),e.cliente?.telefone&&window.open(o.getWhatsAppClientLink(e,e.cliente.telefone,`agendado`),`_blank`),G())},title:`Aceitar e Agendar`,style:{color:`#f59e0b`},children:`ðŸ“…`})]})]}),(0,d.jsx)(`button`,{className:`btn-icon`,onClick:()=>P(e),title:`Painel do TÃ©cnico`,style:{color:e.rastreamento_ativo?`#2563eb`:`inherit`},children:`ðŸ›°ï¸`}),W&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(`button`,{className:`btn-icon`,onClick:()=>q(e),title:`Editar`,children:(0,d.jsx)(h,{})}),(0,d.jsx)(`button`,{className:`btn-icon danger`,onClick:()=>R(e),title:`Excluir`,children:(0,d.jsx)(g,{})})]})]})})]},e.id))})]})}),k&&(0,d.jsx)(C,{ordem:j,clientes:r,tecnicos:l,onClose:Y,onSave:()=>{Y(),G()}}),L&&(0,d.jsx)(w,{title:`Excluir Ordem`,message:`Tem certeza que deseja excluir a ordem #${L.numero}? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,onConfirm:J,onCancel:()=>R(null),loading:z}),N&&(0,d.jsx)(O,{ordem:N,onClose:()=>P(null),onUpdate:G}),F&&(0,d.jsx)(f,{onClose:()=>I(!1)})]})}export{k as OrdensPage,k as default};