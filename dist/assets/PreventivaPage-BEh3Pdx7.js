import{c as e,o as t,r as n,t as r}from"./index-C9yBzEdM.js";/* empty css                 */import{t as i}from"./preventivaService-BBUvhp7P.js";import{t as a}from"./clientesService-BnZzC_Tg.js";/* empty css                  */var o=e(t(),1),s=n(),c=()=>(0,s.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`line`,{x1:`12`,y1:`5`,x2:`12`,y2:`19`}),(0,s.jsx)(`line`,{x1:`5`,y1:`12`,x2:`19`,y2:`12`})]}),l=()=>(0,s.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`path`,{d:`M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`}),(0,s.jsx)(`path`,{d:`M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z`})]}),u=()=>(0,s.jsxs)(`svg`,{width:`16`,height:`16`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`polyline`,{points:`3 6 5 6 21 6`}),(0,s.jsx)(`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`})]}),d=()=>(0,s.jsxs)(`svg`,{width:`20`,height:`20`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`line`,{x1:`18`,y1:`6`,x2:`6`,y2:`18`}),(0,s.jsx)(`line`,{x1:`6`,y1:`6`,x2:`18`,y2:`18`})]}),f=()=>(0,s.jsxs)(`svg`,{width:`48`,height:`48`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.5`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,s.jsx)(`path`,{d:`M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2`}),(0,s.jsx)(`rect`,{x:`8`,y:`2`,width:`8`,height:`4`,rx:`1`,ry:`1`})]});function p({plano:e,clientes:t,empresaId:n,onClose:r,onSave:a}){let[c,l]=(0,o.useState)({titulo:e?.titulo||``,cliente_id:e?.cliente_id||``,equipamento:e?.equipamento||``,localizacao:e?.localizacao||``,frequencia_dias:e?.frequencia_dias||30,proxima_visita:e?.proxima_visita||new Date().toISOString().split(`T`)[0],empresa_id:n}),[u,f]=(0,o.useState)(!1),[p,m]=(0,o.useState)(``);return(0,s.jsx)(`div`,{className:`modal-overlay`,onClick:r,children:(0,s.jsxs)(`div`,{className:`modal-content`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)(`div`,{className:`modal-header`,children:[(0,s.jsx)(`h2`,{className:`modal-title`,children:e?`Editar Plano PMOC`:`Novo Plano PMOC`}),(0,s.jsx)(`button`,{className:`modal-close`,onClick:r,children:(0,s.jsx)(d,{})})]}),(0,s.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),f(!0),m(``);try{e?await i.atualizarPlano(e.id,c):await i.criarPlano(c),a()}catch(e){m(`Erro ao salvar plano de manutenção.`),console.error(e)}finally{f(!1)}},children:[(0,s.jsxs)(`div`,{className:`modal-body`,children:[p&&(0,s.jsx)(`div`,{className:`error-message`,children:p}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Título do Plano *`}),(0,s.jsx)(`input`,{type:`text`,className:`form-input`,value:c.titulo,onChange:e=>l({...c,titulo:e.target.value}),placeholder:`Ex: PMOC - Ar Condicionado Split`,required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Cliente *`}),(0,s.jsxs)(`select`,{className:`form-select`,value:c.cliente_id,onChange:e=>l({...c,cliente_id:e.target.value}),required:!0,children:[(0,s.jsx)(`option`,{value:``,children:`Selecione um cliente...`}),t.map(e=>(0,s.jsx)(`option`,{value:e.id,children:e.nome},e.id))]})]}),(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Equipamento *`}),(0,s.jsx)(`input`,{type:`text`,className:`form-input`,value:c.equipamento,onChange:e=>l({...c,equipamento:e.target.value}),placeholder:`Ex: Split 12000 BTUs`,required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Localização (Sala/Setor)`}),(0,s.jsx)(`input`,{type:`text`,className:`form-input`,value:c.localizacao,onChange:e=>l({...c,localizacao:e.target.value})})]})]}),(0,s.jsxs)(`div`,{className:`form-row`,children:[(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Frequência (Dias)`}),(0,s.jsx)(`input`,{type:`number`,min:`1`,className:`form-input`,value:c.frequencia_dias,onChange:e=>l({...c,frequencia_dias:parseInt(e.target.value)}),required:!0})]}),(0,s.jsxs)(`div`,{className:`form-group`,children:[(0,s.jsx)(`label`,{className:`form-label`,children:`Próxima Visita`}),(0,s.jsx)(`input`,{type:`date`,className:`form-input`,value:c.proxima_visita,onChange:e=>l({...c,proxima_visita:e.target.value}),required:!0})]})]})]}),(0,s.jsxs)(`div`,{className:`modal-footer`,children:[(0,s.jsx)(`button`,{type:`button`,className:`btn-secondary`,onClick:r,children:`Cancelar`}),(0,s.jsx)(`button`,{type:`submit`,className:`btn-primary`,disabled:u,children:u?`Salvando...`:`Salvar`})]})]})]})})}function m(){let{userProfile:e}=r(),[t,n]=(0,o.useState)([]),[d,m]=(0,o.useState)([]),[h,g]=(0,o.useState)(!0),[_,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(null),x=async()=>{if(e?.empresa_id)try{g(!0);let[t,r]=await Promise.all([i.listarPlanos(e.empresa_id),a.listar()]);n(t),m(r)}catch(e){console.error(`Erro ao carregar dados:`,e)}finally{g(!1)}};(0,o.useEffect)(()=>{x()},[e?.empresa_id]);let S=()=>{b(null),v(!0)},C=e=>{b(e),v(!0)},w=async e=>{if(window.confirm(`Tem certeza que deseja excluir este plano?`))try{await i.excluirPlano(e),x()}catch(e){console.error(`Erro ao excluir:`,e)}},T=e=>e?new Date(e).toLocaleDateString(`pt-BR`):`-`;return(0,s.jsxs)(`div`,{className:`contratos-page`,children:[` `,(0,s.jsxs)(`div`,{className:`contratos-header`,children:[(0,s.jsx)(`h1`,{className:`contratos-title`,children:`Manutenção Preventiva (PMOC)`}),(0,s.jsxs)(`button`,{className:`btn-primary`,onClick:S,children:[(0,s.jsx)(c,{}),` Novo Plano`]})]}),h?(0,s.jsx)(`div`,{className:`loading-spinner`,children:(0,s.jsx)(`div`,{className:`spinner`})}):t.length===0?(0,s.jsxs)(`div`,{className:`empty-state`,children:[(0,s.jsx)(`div`,{className:`empty-icon`,children:(0,s.jsx)(f,{})}),(0,s.jsx)(`h3`,{className:`empty-title`,children:`Nenhum plano PMOC encontrado`}),(0,s.jsx)(`p`,{className:`empty-description`,children:`Crie planos de manutenção recorrente para seus clientes.`})]}):(0,s.jsx)(`div`,{className:`table-container`,children:(0,s.jsxs)(`table`,{className:`data-table`,children:[(0,s.jsx)(`thead`,{children:(0,s.jsxs)(`tr`,{children:[(0,s.jsx)(`th`,{children:`Título/Equipamento`}),(0,s.jsx)(`th`,{children:`Cliente`}),(0,s.jsx)(`th`,{children:`Frequência`}),(0,s.jsx)(`th`,{children:`Última Visita`}),(0,s.jsx)(`th`,{children:`Próxima Visita`}),(0,s.jsx)(`th`,{children:`Status`}),(0,s.jsx)(`th`,{children:`Ações`})]})}),(0,s.jsx)(`tbody`,{children:t.map(e=>(0,s.jsxs)(`tr`,{children:[(0,s.jsxs)(`td`,{children:[(0,s.jsx)(`div`,{className:`table-name`,children:e.titulo}),(0,s.jsxs)(`div`,{style:{fontSize:`0.8rem`,color:`#666`},children:[e.equipamento,` - `,e.localizacao]})]}),(0,s.jsx)(`td`,{children:e.cliente?.nome}),(0,s.jsxs)(`td`,{children:[`A cada `,e.frequencia_dias,` dias`]}),(0,s.jsx)(`td`,{children:T(e.ultima_visita||``)}),(0,s.jsx)(`td`,{children:T(e.proxima_visita||``)}),(0,s.jsx)(`td`,{children:(0,s.jsx)(`span`,{className:e.ativo?`badge-ativo`:`badge-inativo`,children:e.ativo?`Ativo`:`Inativo`})}),(0,s.jsx)(`td`,{children:(0,s.jsxs)(`div`,{className:`table-actions`,children:[(0,s.jsx)(`button`,{className:`btn-icon`,onClick:()=>C(e),children:(0,s.jsx)(l,{})}),(0,s.jsx)(`button`,{className:`btn-icon danger`,onClick:()=>w(e.id),children:(0,s.jsx)(u,{})})]})})]},e.id))})]})}),_&&e?.empresa_id&&(0,s.jsx)(p,{plano:y,clientes:d,empresaId:e.empresa_id,onClose:()=>v(!1),onSave:()=>{v(!1),x()}})]})}export{m as PreventivaPage,m as default};