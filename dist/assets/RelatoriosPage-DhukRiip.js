import{c as e,n as t,o as n,r}from"./index-C9yBzEdM.js";var i=e(n(),1);const a={async faturamentoSemestral(){let e=new Date,n=new Date(e.getFullYear(),e.getMonth()-5,1),{data:r,error:i}=await t.from(`ordens_servico`).select(`valor, data_conclusao`).eq(`status`,`concluida`).gte(`data_conclusao`,n.toISOString());if(i)throw i;let a={},o=[`Jan`,`Fev`,`Mar`,`Abr`,`Mai`,`Jun`,`Jul`,`Ago`,`Set`,`Out`,`Nov`,`Dez`];for(let t=0;t<6;t++){let n=new Date(e.getFullYear(),e.getMonth()-t,1),r=`${o[n.getMonth()]}/${n.getFullYear().toString().substr(2)}`;a[r]=0}return r?.forEach(e=>{if(!e.data_conclusao||!e.valor)return;let t=new Date(e.data_conclusao),n=`${o[t.getMonth()]}/${t.getFullYear().toString().substr(2)}`;a[n]!==void 0&&(a[n]+=e.valor)}),Object.entries(a).map(([e,t])=>({mes:e,valor:t})).reverse()},async servicosPorTipo(){let{data:e,error:n}=await t.from(`ordens_servico`).select(`tipo, valor`).eq(`status`,`concluida`);if(n)throw n;let r={};return e?.forEach(e=>{let t=e.tipo;r[t]||(r[t]={quantidade:0,valor:0}),r[t].quantidade++,r[t].valor+=e.valor||0}),Object.entries(r).map(([e,t])=>({tipo:e,quantidade:t.quantidade,valor:t.valor})).sort((e,t)=>t.valor-e.valor)},async topClientes(){let{data:e,error:n}=await t.from(`ordens_servico`).select(`
                valor,
                cliente:clientes(nome)
            `).eq(`status`,`concluida`);if(n)throw n;let r={};return e?.forEach(e=>{let t=e.cliente?.nome||`Cliente Desconhecido`,n=e.valor||0;r[t]||(r[t]={nome:t,total_ordens:0,valor_total:0}),r[t].total_ordens++,r[t].valor_total+=n}),Object.values(r).sort((e,t)=>t.valor_total-e.valor_total).slice(0,5)},async resumoGeral(){let{data:e,error:n}=await t.from(`ordens_servico`).select(`valor`).eq(`status`,`concluida`);if(n)throw n;let r=e?.length||0,i=e?.reduce((e,t)=>e+(t.valor||0),0)||0;return{faturamentoTotal:i,ordensConcluidas:r,ticketMedio:r>0?i/r:0}}};var o=r(),s=()=>(0,o.jsxs)(`svg`,{width:`24`,height:`24`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`line`,{x1:`12`,y1:`20`,x2:`12`,y2:`10`}),(0,o.jsx)(`line`,{x1:`18`,y1:`20`,x2:`18`,y2:`4`}),(0,o.jsx)(`line`,{x1:`6`,y1:`20`,x2:`6`,y2:`16`})]}),c=()=>(0,o.jsxs)(`svg`,{width:`24`,height:`24`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`circle`,{cx:`12`,cy:`12`,r:`10`}),(0,o.jsx)(`path`,{d:`M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z`})]}),l=()=>(0,o.jsxs)(`svg`,{width:`24`,height:`24`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:`2`,strokeLinecap:`round`,strokeLinejoin:`round`,children:[(0,o.jsx)(`polyline`,{points:`22 7 13.5 15.5 8.5 10.5 2 17`}),(0,o.jsx)(`polyline`,{points:`16 7 22 7 22 13`})]});function u(){let[e,t]=(0,i.useState)(!0),[n,r]=(0,i.useState)([]),[u,d]=(0,i.useState)([]),[f,p]=(0,i.useState)([]),[m,h]=(0,i.useState)({faturamentoTotal:0,ordensConcluidas:0,ticketMedio:0});(0,i.useEffect)(()=>{(async()=>{try{t(!0);let[e,n,i,o]=await Promise.all([a.faturamentoSemestral(),a.servicosPorTipo(),a.topClientes(),a.resumoGeral()]);r(e),d(n),p(i),h(o)}catch(e){console.error(`Erro ao carregar relatórios:`,e)}finally{t(!1)}})()},[]);let g=e=>new Intl.NumberFormat(`pt-BR`,{style:`currency`,currency:`BRL`}).format(e),_=e=>({instalacao:`Instalação`,manutencao:`Manutenção`,reparo:`Reparo`,limpeza:`Limpeza`})[e]||e,v=Math.max(...n.map(e=>e.valor),1),y=Math.max(...u.map(e=>e.valor),1),b=Math.max(...f.map(e=>e.valor_total),1);return e?(0,o.jsx)(`div`,{className:`table-container`,children:(0,o.jsx)(`div`,{className:`loading-spinner`,children:(0,o.jsx)(`div`,{className:`spinner`})})}):(0,o.jsxs)(`div`,{className:`relatorios-page`,children:[(0,o.jsx)(`div`,{className:`page-header`,children:(0,o.jsx)(`h1`,{className:`page-title`,children:`Relatórios Gerenciais`})}),(0,o.jsxs)(`div`,{className:`summary-stats`,children:[(0,o.jsxs)(`div`,{className:`stat-box`,children:[(0,o.jsx)(`div`,{className:`stat-box-label`,children:`Faturamento Total`}),(0,o.jsx)(`div`,{className:`stat-box-value`,children:g(m.faturamentoTotal)})]}),(0,o.jsxs)(`div`,{className:`stat-box`,children:[(0,o.jsx)(`div`,{className:`stat-box-label`,children:`Ordens Concluídas`}),(0,o.jsx)(`div`,{className:`stat-box-value`,children:m.ordensConcluidas})]}),(0,o.jsxs)(`div`,{className:`stat-box`,children:[(0,o.jsx)(`div`,{className:`stat-box-label`,children:`Ticket Médio`}),(0,o.jsx)(`div`,{className:`stat-box-value`,children:g(m.ticketMedio)})]})]}),(0,o.jsxs)(`div`,{className:`reports-grid`,children:[(0,o.jsxs)(`div`,{className:`report-card full-width`,children:[(0,o.jsxs)(`div`,{className:`card-header`,children:[(0,o.jsx)(l,{}),(0,o.jsx)(`h3`,{className:`card-title`,children:`Faturamento Semestral`})]}),(0,o.jsx)(`div`,{className:`financial-chart`,children:n.map((e,t)=>(0,o.jsxs)(`div`,{className:`bar-group`,children:[(0,o.jsx)(`div`,{className:`bar-column`,style:{height:`${e.valor/v*100}%`},children:(0,o.jsx)(`div`,{className:`bar-tooltip`,children:g(e.valor)})}),(0,o.jsx)(`div`,{className:`bar-label`,children:e.mes})]},t))})]}),(0,o.jsxs)(`div`,{className:`report-card`,children:[(0,o.jsxs)(`div`,{className:`card-header`,children:[(0,o.jsx)(c,{}),(0,o.jsx)(`h3`,{className:`card-title`,children:`Receita por Serviço`})]}),(0,o.jsx)(`div`,{className:`chart-list`,children:u.length===0?(0,o.jsx)(`div`,{style:{color:`#666`,textAlign:`center`,padding:`1rem`},children:`Sem dados`}):u.map((e,t)=>(0,o.jsxs)(`div`,{className:`chart-item`,children:[(0,o.jsxs)(`div`,{className:`chart-item-header`,children:[(0,o.jsxs)(`span`,{children:[_(e.tipo),` (`,e.quantidade,`)`]}),(0,o.jsx)(`span`,{children:g(e.valor)})]}),(0,o.jsx)(`div`,{className:`progress-bar-bg`,children:(0,o.jsx)(`div`,{className:`progress-bar-fill ${e.tipo}`,style:{width:`${e.valor/y*100}%`}})})]},t))})]}),(0,o.jsxs)(`div`,{className:`report-card`,children:[(0,o.jsxs)(`div`,{className:`card-header`,children:[(0,o.jsx)(s,{}),(0,o.jsx)(`h3`,{className:`card-title`,children:`Top 5 Clientes`})]}),(0,o.jsx)(`div`,{className:`chart-list`,children:f.length===0?(0,o.jsx)(`div`,{style:{color:`#666`,textAlign:`center`,padding:`1rem`},children:`Sem dados`}):f.map((e,t)=>(0,o.jsxs)(`div`,{className:`chart-item`,children:[(0,o.jsxs)(`div`,{className:`chart-item-header`,children:[(0,o.jsx)(`span`,{children:e.nome}),(0,o.jsx)(`span`,{children:g(e.valor_total)})]}),(0,o.jsx)(`div`,{className:`progress-bar-bg`,children:(0,o.jsx)(`div`,{className:`progress-bar-fill`,style:{width:`${e.valor_total/b*100}%`,background:`#6366f1`}})})]},t))})]})]})]})}export{u as RelatoriosPage,u as default};