import{n as e}from"./index-C9yBzEdM.js";const t={async listarEmpresas(){let{data:t,error:n}=await e.from(`empresas`).select(`*`).order(`nome`);if(n)throw n;return t||[]},async criarEmpresa(t){let{data:n,error:r}=await e.from(`empresas`).insert(t).select().single();if(r)throw r;return n},async atualizarEmpresa(t,n){let{data:r,error:i}=await e.from(`empresas`).update(n).eq(`id`,t).select().single();if(i)throw i;return r},async excluirEmpresa(t){let{error:n}=await e.from(`empresas`).delete().eq(`id`,t);if(n)throw n},async listarUsuarios(){let{data:t,error:n}=await e.from(`perfis`).select(`*, empresa:empresas(nome)`).order(`nome`);if(n)throw n;return t||[]},async listarUsuariosPorEmpresa(t){let{data:n,error:r}=await e.from(`perfis`).select(`*, empresa:empresas(nome)`).eq(`empresa_id`,t).order(`nome`);if(r)throw r;return n||[]},async atualizarPerfilUsuario(t,n){let{data:r,error:i}=await e.from(`perfis`).update({role:n.role,empresa_id:n.empresa_id,nome:n.nome,telefone:n.telefone}).eq(`id`,t).select(`*, empresa:empresas(nome)`).single();if(i)throw i;if(n.password&&n.password.trim()!==``){let{error:r}=await e.rpc(`update_user_password`,{user_id:t,new_password:n.password});if(r)throw console.error(`Erro ao atualizar senha:`,r),Error(`Perfil atualizado, mas erro ao alterar senha: `+r.message)}return r},async criarUsuarioComAcesso(t){let{data:n,error:r}=await e.auth.signUp({email:t.email,password:t.password||`Mudar@123`,options:{data:{nome:t.nome,role:t.role}}});if(r)throw r.message.includes(`User already registered`)?Error(`Este e-mail já está cadastrado no sistema. Se o perfil não aparecer na lista, verifique se ele pertence a outra empresa ou entre em contato com o suporte.`):r;if(!n.user)throw Error(`Não foi possível criar o usuário no Auth.`);let{data:i,error:a}=await e.from(`perfis`).upsert({id:n.user.id,empresa_id:t.empresa_id,nome:t.nome,email:t.email,role:t.role,telefone:t.telefone}).select(`*, empresa:empresas(nome)`).single();if(a)throw a;return i},async excluirPerfil(t){let{error:n}=await e.from(`perfis`).delete().eq(`id`,t);if(n)throw n},async listarAuditoria(){let{data:t,error:n}=await e.from(`logs_auditoria`).select(`
                *,
                perfil:perfis(nome),
                empresa:empresas(nome)
            `).order(`created_at`,{ascending:!1}).limit(100);if(n)throw n;return t||[]}};export{t};