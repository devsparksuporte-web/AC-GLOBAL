import{n as e}from"./index-C9yBzEdM.js";const t={async listarCertificacoes(t){let{data:n,error:r}=await e.from(`certificacoes`).select(`*`).eq(`empresa_id`,t).order(`nome`);if(r)throw r;return n||[]},async salvarCertificacao(t){let{data:n,error:r}=await e.from(`certificacoes`).upsert(t).select().single();if(r)throw r;return n},async listarCertificacoesTecnico(t){let{data:n,error:r}=await e.from(`tecnico_certificacoes`).select(`*, certificacao:certificacoes(*)`).eq(`perfil_id`,t);if(r)throw r;return n||[]},async salvarCertificacaoTecnico(t){let{data:n,error:r}=await e.from(`tecnico_certificacoes`).upsert(t).select().single();if(r)throw r;return n},async listarTiposRisco(t){let{data:n,error:r}=await e.from(`tipos_risco`).select(`*`).eq(`empresa_id`,t).order(`nome`);if(r)throw r;return n||[]},async salvarTipoRisco(t){let{data:n,error:r}=await e.from(`tipos_risco`).upsert(t).select().single();if(r)throw r;return n},async listarChecklists(t){let{data:n,error:r}=await e.from(`checklists_seguranca`).select(`*, tipo_risco:tipos_risco(nome)`).eq(`empresa_id`,t);if(r)throw r;return n||[]},async salvarChecklist(t){let{data:n,error:r}=await e.from(`checklists_seguranca`).upsert(t).select().single();if(r)throw r;return n},async validarTecnicoParaRisco(t,n){let{data:r,error:i}=await e.from(`tipos_risco`).select(`*`).eq(`id`,n).single();if(i||!r)throw Error(`Tipo de risco nÃ£o encontrado`);if(!r.certificacoes_requeridas||r.certificacoes_requeridas.length===0)return{valido:!0,pendencias:[]};let a=new Date().toISOString().split(`T`)[0],{data:o,error:s}=await e.from(`tecnico_certificacoes`).select(`certificacao_id, data_vencimento`).eq(`perfil_id`,t).eq(`status`,`ativo`).gte(`data_vencimento`,a);if(s)throw s;let c=new Set(o.map(e=>e.certificacao_id)),l=[],{data:u}=await e.from(`certificacoes`).select(`id, nome`).in(`id`,r.certificacoes_requeridas);return r.certificacoes_requeridas.forEach(e=>{if(!c.has(e)){let t=u?.find(t=>t.id===e)?.nome||e;l.push(t)}}),{valido:l.length===0,pendencias:l}},async registrarSegurancaOS(t){let{data:n,error:r}=await e.from(`os_seguranca`).insert(t).select().single();if(r)throw r;return n},async buscarSegurancaOS(t){let{data:n,error:r}=await e.from(`os_seguranca`).select(`*`).eq(`os_id`,t).maybeSingle();if(r)throw r;return n}};export{t};