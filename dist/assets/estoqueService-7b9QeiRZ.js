import{n as e}from"./index-C9yBzEdM.js";const t={async listar(){let{data:t,error:n}=await e.from(`estoque`).select(`*`).order(`nome`,{ascending:!0});if(n)throw n;return t||[]},async criar(t){let{data:{user:n}}=await e.auth.getUser();if(!n)throw Error(`Usuário não autenticado`);let{data:r}=await e.from(`perfis`).select(`empresa_id`).eq(`id`,n.id).single();if(!r?.empresa_id)throw Error(`Perfil ou empresa não encontrados`);let{data:i,error:a}=await e.from(`estoque`).insert([{...t,empresa_id:r.empresa_id}]).select().single();if(a)throw console.error(`Erro ao criar item no estoque:`,a),a;return i},async atualizar(t,n){let{id:r,created_at:i,updated_at:a,empresa_id:o,...s}=n,{data:c,error:l}=await e.from(`estoque`).update(s).eq(`id`,t).select().single();if(l)throw console.error(`Erro ao atualizar item no estoque:`,l),l;return c},async excluir(t){let{error:n}=await e.from(`estoque`).delete().eq(`id`,t);if(n)throw n},async registrarMovimentacao(t){let{data:{user:n}}=await e.auth.getUser();if(!n)throw Error(`Usuário não autenticado`);let{data:r}=await e.from(`perfis`).select(`empresa_id`).eq(`id`,n.id).single(),{error:i}=await e.from(`movimentacao_estoque`).insert([{...t,empresa_id:r?.empresa_id,usuario_id:n.id}]);if(i)throw i;let{data:a}=await e.from(`estoque`).select(`quantidade`).eq(`id`,t.item_id).single();if(a){let n=t.tipo===`entrada`?Number(a.quantidade)+Number(t.quantidade):Number(a.quantidade)-Number(t.quantidade);await e.from(`estoque`).update({quantidade:n}).eq(`id`,t.item_id)}}};export{t};